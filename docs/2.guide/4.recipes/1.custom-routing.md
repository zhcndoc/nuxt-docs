---
title: "自定义路由"
description: "在 Nuxt 中，你的路由由 pages 目录内文件的结构定义。然而，由于其在底层使用 vue-router，Nuxt 为你提供了几种在项目中添加自定义路由的方法。"
---

## 添加自定义路由

在 Nuxt 中，你的路由由 [app/pages 目录](/docs/4.x/guide/directory-structure/app/pages) 内文件的结构定义。然而，由于其底层使用 [vue-router](https://router.vuejs.org)，Nuxt 为你提供了几种在项目中添加自定义路由的方法。

### Router Config

使用 [router options](/docs/4.x/guide/recipes/custom-routing#router-options)，你可以可选地通过一个接收已扫描路由并返回自定义路由的函数来覆盖或扩展路由。

如果它返回 `null` 或 `undefined`，Nuxt 将回退到默认路由（在需要修改输入数组时很有用）。

```ts [router.options.ts]
import type { RouterConfig } from '@nuxt/schema'

export default {
  // https://router.vuejs.org/api/interfaces/routeroptions.html#routes
  routes: _routes => [
    {
      name: 'home',
      path: '/',
      component: () => import('~/pages/home.vue'),
    },
  ],
} satisfies RouterConfig
```

::note
Nuxt 不会为你从 `routes` 函数返回的任何新路由添加由你提供的组件中的 `definePageMeta` 定义的元数据。如果你希望发生这种情况，应该使用在[构建时调用](/docs/4.x/api/advanced/hooks#nuxt-hooks-build-time)的 `pages:extend` 钩子。
::

### Pages Hook

你可以使用 `pages:extend` Nuxt 钩子在已扫描路由中添加、修改或移除页面。

例如，阻止为任何 `.ts` 文件创建路由：

```ts [nuxt.config.ts]
import type { NuxtPage } from '@nuxt/schema'

export default defineNuxtConfig({
  hooks: {
    'pages:extend' (pages) {
      // add a route
      pages.push({
        name: 'profile',
        path: '/profile',
        file: '~/extra-pages/profile.vue',
      })

      // remove routes
      function removePagesMatching (pattern: RegExp, pages: NuxtPage[] = []) {
        const pagesToRemove: NuxtPage[] = []
        for (const page of pages) {
          if (page.file && pattern.test(page.file)) {
            pagesToRemove.push(page)
          } else {
            removePagesMatching(pattern, page.children)
          }
        }
        for (const page of pagesToRemove) {
          pages.splice(pages.indexOf(page), 1)
        }
      }
      removePagesMatching(/\.ts$/, pages)
    },
  },
})
```

### Nuxt Module

如果你打算添加与特定功能相关的一整套页面，你可能想要使用一个 [Nuxt 模块](/modules)。

[Nuxt kit](/docs/4.x/guide/going-further/kit) 提供了几种 [添加路由](/docs/4.x/api/kit/pages) 的方式：
- [`extendPages`](/docs/4.x/api/kit/pages#extendpages) (回调: pages => void)
- [`extendRouteRules`](/docs/4.x/api/kit/pages#extendrouterules) (route: string, rule: NitroRouteConfig, options: ExtendRouteRulesOptions)

## Router Options

除了为 [`vue-router`](https://router.vuejs.org/api/interfaces/routeroptions.html) 自定义选项之外，Nuxt 还提供了 [额外选项](/docs/4.x/api/nuxt-config#router) 来自定义路由器。

### 使用 `router.options`

这是指定 [router options](/docs/4.x/api/nuxt-config#router) 的推荐方式。

```ts [router.options.ts]
import type { RouterConfig } from '@nuxt/schema'

export default {
} satisfies RouterConfig
```

可以通过在 `pages:routerOptions` 钩子中添加文件来增加更多的路由选项文件。数组中后面的项会覆盖前面的项。

::callout
在此钩子中添加路由选项文件会启用基于页面的路由，除非将 `optional` 设置为 true，此时只有在已启用基于页面的路由时才会应用该文件。
::

```ts [nuxt.config.ts]
import { createResolver } from '@nuxt/kit'

export default defineNuxtConfig({
  hooks: {
    'pages:routerOptions' ({ files }) {
      const resolver = createResolver(import.meta.url)
      // add a route
      files.push({
        path: resolver.resolve('./runtime/router-options'),
        optional: true,
      })
    },
  },
})
```

### 使用 `nuxt.config`

**注意：** 只有可 JSON 序列化的 [选项](/docs/4.x/api/nuxt-config#router) 可配置：

- `linkActiveClass`
- `linkExactActiveClass`
- `end`
- `sensitive`
- `strict`
- `hashMode`
- `scrollBehaviorType`

```ts [nuxt.config]
export default defineNuxtConfig({
  router: {
    options: {},
  },
})
```

### Hash 模式（SPA）

你可以在 SPA 模式下使用 `hashMode` [配置](/docs/4.x/api/nuxt-config#router) 启用 hash 历史模式。在此模式下，路由器在实际 URL 之前使用井号字符（#）。启用时，**URL 永远不会发送到服务器**，并且**不支持 SSR**。

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  ssr: false,
  router: {
    options: {
      hashMode: true,
    },
  },
})
```

### 针对 hash 链接的滚动行为

你可以可选地自定义 hash 链接的滚动行为。当你将 [配置](/docs/4.x/api/nuxt-config#router) 设置为 `smooth` 并加载带有 hash 链接的页面（例如 `https://example.com/blog/my-article#comments`）时，你会看到浏览器平滑地滚动到该锚点。

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  router: {
    options: {
      scrollBehaviorType: 'smooth',
    },
  },
})
```

#### 自定义 History（高级）

你可以可选地使用一个接收基准 URL 并返回 history 模式的函数来覆盖 history 模式。如果它返回 `null` 或 `undefined`，Nuxt 将回退到默认 history。

```ts [router.options.ts]
import type { RouterConfig } from '@nuxt/schema'
import { createMemoryHistory } from 'vue-router'

export default {
  // https://router.vuejs.org/api/interfaces/routeroptions.html
  history: base => import.meta.client ? createMemoryHistory(base) : null, /* default */
} satisfies RouterConfig
```