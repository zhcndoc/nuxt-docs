---
title: å‡çº§æŒ‡å—
description: 'äº†è§£å¦‚ä½•å‡çº§åˆ°æœ€æ–°çš„ Nuxt ç‰ˆæœ¬ã€‚'
navigation.icon: i-lucide-circle-arrow-up
---

## å‡çº§ Nuxt

### æœ€æ–°å‘å¸ƒ

è¦å°† Nuxt å‡çº§åˆ° [æœ€æ–°å‘å¸ƒ](https://github.com/nuxt/nuxt/releases)ï¼Œè¯·ä½¿ç”¨ `nuxi upgrade` å‘½ä»¤ã€‚

::code-group{sync="pm"}

```bash [npm]
npx nuxi upgrade
```

```bash [yarn]
yarn dlx nuxi upgrade
```

```bash [pnpm]
pnpm dlx nuxi upgrade
```

```bash [bun]
bun x nuxi upgrade
```

::

### æ¯æ—¥æ„å»ºæ¸ é“

è¦ä½¿ç”¨æœ€æ–°çš„ Nuxt æ„å»ºå¹¶åœ¨å‘å¸ƒä¹‹å‰æµ‹è¯•åŠŸèƒ½ï¼Œè¯·é˜…è¯» [æ¯æ—¥æ„å»ºæ¸ é“](/docs/guide/going-further/nightly-release-channel) æŒ‡å—ã€‚

::warning
æ¯æ—¥æ„å»ºæ¸ é“çš„ `latest` æ ‡ç­¾ç›®å‰æ­£åœ¨è·Ÿè¸ª Nuxt v4 åˆ†æ”¯ï¼Œè¿™æ„å‘³ç€ç›®å‰ç‰¹åˆ«æœ‰å¯èƒ½åŒ…å«ç ´åæ€§æ›´æ”¹ - è¯·å°å¿ƒï¼

æ‚¨å¯ä»¥é€‰æ‹©åŠ å…¥ 3.x åˆ†æ”¯çš„æ¯æ—¥æ„å»ºå‘å¸ƒï¼Œä½¿ç”¨ `"nuxt": "npm:nuxt-nightly@3x"`ã€‚
::

## æµ‹è¯• Nuxt 4

Nuxt 4 çš„å‘å¸ƒæ—¥æœŸ**å¾…å®š**ã€‚å®ƒä¾èµ–äºåœ¨ Nitro çš„ä¸»è¦å‘å¸ƒåæœ‰è¶³å¤Ÿçš„æ—¶é—´åœ¨ç¤¾åŒºä¸­è¿›è¡Œé€‚å½“çš„æµ‹è¯•ã€‚æ‚¨å¯ä»¥åœ¨ [æ­¤ PR](https://github.com/nitrojs/nitro/pull/2521) ä¸­è·Ÿè¸ª Nitro å‘å¸ƒçš„è¿›å±•ã€‚

åœ¨å‘å¸ƒä¹‹å‰ï¼Œå¯ä»¥æµ‹è¯• Nuxt 3.12+ ç‰ˆæœ¬ä¸­çš„è®¸å¤š Nuxt 4 çš„ç ´åæ€§æ›´æ”¹ã€‚

:video-accordion{title="è§‚çœ‹æ¥è‡ª Alexander Lichter çš„è§†é¢‘ï¼ŒæŸ¥çœ‹å¦‚ä½•é€‰æ‹©åŠ å…¥ Nuxt 4 çš„ç ´åæ€§æ›´æ”¹" videoId="r4wFKlcJK6c"}

### é€‰æ‹©åŠ å…¥ Nuxt 4

é¦–å…ˆï¼Œå°† Nuxt å‡çº§åˆ° [æœ€æ–°å‘å¸ƒ](https://github.com/nuxt/nuxt/releases)ã€‚

ç„¶åï¼Œæ‚¨å¯ä»¥å°† `compatibilityVersion` è®¾ç½®ä¸ºåŒ¹é… Nuxt 4 çš„è¡Œä¸ºï¼š

::code-collapse
```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  future: {
    compatibilityVersion: 4,
  },
  // è¦é‡æ–°å¯ç”¨ _æ‰€æœ‰_ Nuxt v3 çš„è¡Œä¸ºï¼Œè¯·è®¾ç½®ä»¥ä¸‹é€‰é¡¹ï¼š
  // srcDir: '.',
  // dir: {
  //   app: 'app'
  // },
  // experimental: {
  //   scanPageMeta: 'after-resolve',
  //   sharedPrerenderData: false,
  //   compileTemplate: true,
  //   resetAsyncDataToUndefined: true,
  //   templateUtils: true,
  //   relativeWatchPaths: true,
  //   normalizeComponentNames: false,
  //   spaLoadingTemplateLocation: 'within',
  //   defaults: {
  //     useAsyncData: {
  //       deep: true
  //     }
  //   }
  // },
  // features: {
  //   inlineStyles: true
  // },
  // unhead: {
  //   renderSSRHeadOptions: {
  //     omitLineBreaks: false
  //   }
  // }
})
```
::

::note
ç›®å‰ï¼Œæ‚¨éœ€è¦åœ¨é€‰æ‹©åŠ å…¥ Nuxt 4 è¡Œä¸ºçš„æ¯ä¸€å±‚ä¸­å®šä¹‰å…¼å®¹æ€§ç‰ˆæœ¬ã€‚å‘å¸ƒ Nuxt 4 åå°†ä¸å†éœ€è¦ã€‚
::

å½“æ‚¨å°† `compatibilityVersion` è®¾ç½®ä¸º `4` æ—¶ï¼Œæ•´ä¸ª Nuxt é…ç½®çš„é»˜è®¤å€¼å°†æ›´æ”¹ä¸ºé€‰æ‹©åŠ å…¥ Nuxt v4 è¡Œä¸ºï¼Œä½†æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚åœ¨æµ‹è¯•æ—¶ç»†è‡´åœ°é‡æ–°å¯ç”¨ Nuxt v3 è¡Œä¸ºï¼Œéµå¾ªä¸Šé¢çš„æ³¨é‡Šè¡Œã€‚å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æäº¤ issueï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨ Nuxt æˆ–ç”Ÿæ€ç³»ç»Ÿä¸­è¿›è¡Œä¿®å¤ã€‚

ç ´åæ€§æˆ–é‡è¦çš„æ›´æ”¹å°†åœ¨æ­¤å¤„è¯´æ˜ï¼Œå¹¶é™„æœ‰å‘å/å‘å‰å…¼å®¹çš„è¿ç§»æ­¥éª¤ã€‚

::note
åœ¨æœ€ç»ˆå‘å¸ƒä¹‹å‰ï¼Œæ­¤éƒ¨åˆ†å¯èƒ½ä¼šæ›´æ”¹ï¼Œå› æ­¤å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ `compatibilityVersion: 4` æµ‹è¯• Nuxt 4ï¼Œè¯·å®šæœŸè¿”å›æŸ¥çœ‹ã€‚
::

### ä½¿ç”¨ Codemods è¿›è¡Œè¿ç§»

ä¸ºäº†æ–¹ä¾¿å‡çº§æµç¨‹ï¼Œæˆ‘ä»¬ä¸ [Codemod](https://github.com/codemod-com/codemod) å›¢é˜Ÿåˆä½œï¼Œä½¿ç”¨ä¸€äº›å¼€æºçš„ codemods è‡ªåŠ¨åŒ–è®¸å¤šè¿ç§»æ­¥éª¤ã€‚

::note
å¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·é€šè¿‡ `npx codemod feedback` å‘ Codemod å›¢é˜ŸæŠ¥å‘Š ğŸ™
::

è¦è·å–å®Œæ•´çš„ Nuxt 4 codemods åˆ—è¡¨ï¼Œä»¥åŠæ¯ä¸ª codemod çš„è¯¦ç»†ä¿¡æ¯ã€æºå’Œå„ç§è¿è¡Œæ–¹å¼ï¼Œè¯·è®¿é—® [Codemod æ³¨å†Œè¡¨](https://go.codemod.com/codemod-registry)ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ `codemod` è„šæœ¬è¿è¡Œæœ¬æŒ‡å—ä¸­æåˆ°çš„æ‰€æœ‰ codemodsï¼š

::code-group

```bash [npm]
npx codemod@latest nuxt/4/migration-recipe
```

```bash [yarn]
yarn dlx codemod@latest nuxt/4/migration-recipe
```

```bash [pnpm]
pnpm dlx codemod@latest nuxt/4/migration-recipe
```

```bash [bun]
bun x codemod@latest nuxt/4/migration-recipe
```

::

æ­¤å‘½ä»¤å°†é¡ºåºæ‰§è¡Œæ‰€æœ‰ codemodsï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸è¿è¡Œä»»ä½•ä¸æƒ³æ‰§è¡Œçš„ codemodã€‚æ¯ä¸ª codemod ä¹Ÿå°†åœ¨ä¸‹æ–¹åˆ—å‡ºï¼Œä»¥åŠå…¶å¯¹åº”çš„æ›´æ”¹å¹¶å¯ä»¥å•ç‹¬æ‰§è¡Œã€‚

### æ–°ç›®å½•ç»“æ„

ğŸš¦ **å½±å“çº§åˆ«**ï¼šé‡å¤§

Nuxt ç°åœ¨é»˜è®¤ä½¿ç”¨æ–°çš„ç›®å½•ç»“æ„ï¼Œå¹¶ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆå› æ­¤å¦‚æœ Nuxt æ£€æµ‹åˆ°æ‚¨ä½¿ç”¨çš„æ˜¯æ—§ç»“æ„ï¼Œä¾‹å¦‚é¡¶çº§ `pages/` ç›®å½•ï¼Œåˆ™æ–°ç»“æ„å°†ä¸é€‚ç”¨ï¼‰ã€‚

ğŸ‘‰ [æŸ¥çœ‹å®Œæ•´ RFC](https://github.com/nuxt/nuxt/issues/26444)

#### æ”¹å˜äº†ä»€ä¹ˆ

* æ–°çš„ Nuxt é»˜è®¤ `srcDir` é»˜è®¤æ˜¯ `app/`ï¼Œå¤§å¤šæ•°å†…å®¹ä»è¿™é‡Œè§£æã€‚
* `serverDir` ç°åœ¨é»˜è®¤æ˜¯ `<rootDir>/server` è€Œä¸æ˜¯ `<srcDir>/server`
* `layers/`ã€`modules/` å’Œ `public/` é»˜è®¤ç›¸å¯¹äº `<rootDir>` è§£æ
* å¦‚æœä½¿ç”¨ [Nuxt Content v2.13+](https://github.com/nuxt/content/pull/2649)ï¼Œ`content/` é»˜è®¤ç›¸å¯¹äº `<rootDir>` è§£æ
* æ–°å¢ `dir.app`ï¼Œæˆ‘ä»¬ä¼šåœ¨æ­¤ç›®å½•ä¸­æŸ¥æ‰¾ `router.options.ts` å’Œ `spa-loading-template.html` - é»˜è®¤æ˜¯ `<srcDir>/`

<details>

<summary>v4 æ–‡ä»¶å¤¹ç»“æ„ç¤ºä¾‹ã€‚</summary>

```sh
.output/
.nuxt/
app/
  assets/
  components/
  composables/
  layouts/
  middleware/
  pages/
  plugins/
  utils/
  app.config.ts
  app.vue
  router.options.ts
content/
layers/
modules/
node_modules/
public/
server/
  api/
  middleware/
  plugins/
  routes/
  utils/
nuxt.config.ts
```

</details>

ğŸ‘‰ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ [å®ç°æ­¤æ›´æ”¹çš„ PR](https://github.com/nuxt/nuxt/pull/27029)ã€‚

#### æ›´æ”¹çš„åŸå› 

1. **æ€§èƒ½** - å°†æ‰€æœ‰ä»£ç æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¼šå¯¼è‡´ `.git/` å’Œ `node_modules/` æ–‡ä»¶å¤¹è¢« FS ç›‘è§†å™¨æ‰«æ/åŒ…å«ï¼Œè¿™å¯èƒ½ä¼šæ˜¾è‘—å»¶è¿Ÿåœ¨é Mac OS ä¸Šçš„å¯åŠ¨ã€‚
2. **IDE ç±»å‹å®‰å…¨** - `server/` å’Œæ‚¨çš„åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†åœ¨ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œå…·æœ‰ä¸åŒçš„å…¨å±€å¯¼å…¥å¯ç”¨ï¼Œç¡®ä¿ `server/` ä¸åœ¨ä¸æ‚¨çš„åº”ç”¨ç¨‹åºå…¶ä»–éƒ¨åˆ†ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­æ˜¯ç¡®ä¿æ‚¨åœ¨ IDE ä¸­è·å¾—è‰¯å¥½è‡ªåŠ¨è¡¥å…¨çš„ç¬¬ä¸€æ­¥ã€‚

:video-accordion{title="è§‚çœ‹æ¥è‡ª Vue School çš„å…³äºæ–°ç›®å½•ç»“æ„çš„è§†é¢‘" videoId="1031028378" platform="vimeo"}

#### è¿ç§»æ­¥éª¤

1. åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œå‘½åä¸º `app/`ã€‚
2. å°† `assets/`ã€`components/`ã€`composables/`ã€`layouts/`ã€`middleware/`ã€`pages/`ã€`plugins/` å’Œ `utils/` æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°å…¶ä¸­ï¼Œä»¥åŠ `app.vue`ã€`error.vue`ã€`app.config.ts`ã€‚å¦‚æœæ‚¨æœ‰ `app/router-options.ts` æˆ– `app/spa-loading-template.html`ï¼Œè¿™äº›è·¯å¾„ä¿æŒä¸å˜ã€‚
3. ç¡®ä¿æ‚¨çš„ `nuxt.config.ts`ã€`content/`ã€`layers/`ã€`modules/`ã€`public/` å’Œ `server/` æ–‡ä»¶å¤¹ä¿æŒåœ¨ `app/` æ–‡ä»¶å¤¹å¤–ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚
4. è®°å¾—æ›´æ–°ä»»ä½•ç¬¬ä¸‰æ–¹é…ç½®æ–‡ä»¶ä»¥é€‚åº”æ–°çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚æ‚¨çš„ `tailwindcss` æˆ– `eslint` é…ç½®ï¼ˆå¦‚æœéœ€è¦ - `@nuxtjs/tailwindcss` åº”è¯¥ä¼šè‡ªåŠ¨æ­£ç¡®é…ç½® `tailwindcss`ï¼‰ã€‚

::tip
æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/file-structure` è‡ªåŠ¨åŒ–æ­¤è¿ç§»
::

ä½†æ˜¯ï¼Œè¿ç§»å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚å¦‚æœæ‚¨å¸Œæœ›ä¿ç•™å½“å‰çš„æ–‡ä»¶å¤¹ç»“æ„ï¼ŒNuxt åº”è¯¥ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°å®ƒã€‚ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œè¯·æäº¤é—®é¢˜ã€‚ï¼‰å”¯ä¸€çš„ä¾‹å¤–æ˜¯ï¼Œå¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ `srcDir`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦æ³¨æ„ï¼Œ`modules/`ã€`public/` å’Œ `server/` æ–‡ä»¶å¤¹å°†ç›¸å¯¹äºæ‚¨çš„ `rootDir` è§£æï¼Œè€Œä¸æ˜¯è‡ªå®šä¹‰çš„ `srcDir`ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½® `dir.modules`ã€`dir.public` å’Œ `serverDir` æ¥è¦†ç›–è¿™ä¸€ç‚¹ã€‚

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é…ç½®å¼ºåˆ¶ä½¿ç”¨ v3 ç›®å½•ç»“æ„ï¼š

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  // è¿™å°† `app` çš„æ–° srcDir é»˜è®¤å€¼æ¢å¤åˆ°æ‚¨çš„æ ¹ç›®å½•
  srcDir: '.',
  // è¿™æ˜¯æŒ‡å®š `app/router.options.ts` å’Œ `app/spa-loading-template.html` çš„ç›®å½•å‰ç¼€
  dir: {
    app: 'app'
  }
})
```

### è·¯ç”±å…ƒæ•°æ®çš„å»é‡

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

å¯ä»¥ä½¿ç”¨ `definePageMeta` è®¾ç½®ä¸€äº›è·¯ç”±å…ƒæ•°æ®ï¼Œä¾‹å¦‚ `name`ã€`path` ç­‰ã€‚ä¹‹å‰è¿™äº›åœ¨è·¯ç”±å’Œè·¯ç”±å…ƒæ•°æ®ä¸Šéƒ½æ˜¯å¯ç”¨çš„ï¼ˆä¾‹å¦‚ `route.name` å’Œ `route.meta.name`ï¼‰ã€‚

ç°åœ¨ï¼Œå®ƒä»¬ä»…å¯åœ¨è·¯ç”±å¯¹è±¡ä¸Šè®¿é—®ã€‚

#### æ›´æ”¹çš„åŸå› 

è¿™æ˜¯ç”±äºé»˜è®¤å¯ç”¨äº† `experimental.scanPageMeta`ï¼Œå¹¶ä¸”æ˜¯æ€§èƒ½ä¼˜åŒ–ã€‚

#### è¿ç§»æ­¥éª¤

è¿ç§»åº”è¯¥æ˜¯ç›´æ¥çš„ï¼š

```diff
  const route = useRoute()
  
- console.log(route.meta.name)
+ console.log(route.name)
```

### æ ‡å‡†åŒ–ç»„ä»¶åç§°

ğŸš¦ **å½±å“çº§åˆ«**ï¼šé€‚ä¸­

Vue ç°åœ¨å°†ç”Ÿæˆä¸ Nuxt ç»„ä»¶å‘½åæ¨¡å¼ç›¸åŒ¹é…çš„ç»„ä»¶åç§°ã€‚

#### æ”¹å˜äº†ä»€ä¹ˆ

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ‰‹åŠ¨è®¾ç½®ï¼ŒVue ä¼šä¸ºç»„ä»¶åˆ†é…ä¸ç»„ä»¶æ–‡ä»¶åç›¸åŒ¹é…çš„ç»„ä»¶åç§°ã€‚

```bash [ç›®å½•ç»“æ„]
â”œâ”€ components/
â”œâ”€â”€â”€ SomeFolder/
â”œâ”€â”€â”€â”€â”€ MyComponent.vue
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡³ Vue è€Œè¨€ï¼Œç»„ä»¶åç§°å°†æ˜¯ `MyComponent`ã€‚å¦‚æœæ‚¨æƒ³è¦ä¸ä¹‹ä½¿ç”¨ `<KeepAlive>`ï¼Œæˆ–è€…åœ¨ Vue DevTools ä¸­è¯†åˆ«å®ƒï¼Œæ‚¨éœ€è¦ä½¿ç”¨è¿™ä¸ªåç§°ã€‚

ä½†ä¸ºäº†è‡ªåŠ¨å¯¼å…¥å®ƒï¼Œæ‚¨éœ€è¦ä½¿ç”¨ `SomeFolderMyComponent`ã€‚

é€šè¿‡æ­¤æ›´æ”¹ï¼Œè¿™ä¸¤ä¸ªå€¼å°†åŒ¹é…ï¼ŒVue å°†ç”Ÿæˆä¸ Nuxt ç»„ä»¶å‘½åæ¨¡å¼ç›¸åŒ¹é…çš„ç»„ä»¶åç§°ã€‚

#### è¿ç§»æ­¥éª¤

ç¡®ä¿åœ¨ä»»ä½•ä½¿ç”¨ `@vue/test-utils` ä¸­çš„ `findComponent` çš„æµ‹è¯•ä¸­ä½¿ç”¨æ›´æ–°çš„åç§°ï¼Œä»¥åŠåœ¨ä»»ä½•ä¾èµ–äºæ‚¨çš„ç»„ä»¶åç§°çš„ `<KeepAlive>` ä¸­ã€‚

æˆ–è€…ï¼Œç›®å‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¦ç”¨æ­¤è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    normalizeComponentNames: false
  }
})
```

### Unhead v2

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

[Unhead](https://unhead.unjs.io/)ï¼Œç”¨äºç”Ÿæˆ `<head>` æ ‡ç­¾ï¼Œå·²ç»æ›´æ–°åˆ°ç‰ˆæœ¬ 2ã€‚è™½ç„¶å¤§éƒ¨åˆ†åŠŸèƒ½ä¿æŒå…¼å®¹ï¼Œä½†åŒ…æ‹¬ä¸€äº›é’ˆå¯¹ä½çº§ APIs çš„ç ´åæ€§æ›´æ”¹ã€‚

* åˆ é™¤çš„å±æ€§ï¼š`vmid`ã€`hid`ã€`children`ã€`body`ã€‚
* ä¸å†æ”¯æŒ Promise è¾“å…¥ã€‚
* æ ‡ç­¾ç°åœ¨é»˜è®¤ä½¿ç”¨ Capo.js è¿›è¡Œæ’åºã€‚

#### è¿ç§»æ­¥éª¤

ä¸Šè¿°æ›´æ”¹å¯¹æ‚¨çš„åº”ç”¨ç¨‹åºåº”å½±å“æœ€å°ã€‚

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œåº”éªŒè¯ï¼š

* æ‚¨æœªä½¿ç”¨ä»»ä½•å·²åˆ é™¤çš„å±æ€§ã€‚

```diff
useHead({
  meta: [{ 
    name: 'description', 
    // å…ƒæ ‡ç­¾æ— éœ€ vmid æˆ– key    
-   vmid: 'description' 
-   hid: 'description'
  }]
})
```

* å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ [Template Params](https://unhead.unjs.io/docs/head/guides/plugins/template-params) æˆ– [Alias Tag Sorting](https://unhead.unjs.io/docs/head/guides/plugins/alias-sorting)ï¼Œæ‚¨ç°åœ¨éœ€è¦æ˜ç¡®é€‰æ‹©è¿™äº›åŠŸèƒ½ã€‚

```ts
import { TemplateParamsPlugin, AliasSortingPlugin } from '@unhead/vue/plugins'

export default defineNuxtPlugin({
  setup() {
    const unhead = injectHead()
    unhead.use(TemplateParamsPlugin)
    unhead.use(AliasSortingPlugin)
  }
})
```

è™½ç„¶ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å»ºè®®å°†ä»»ä½•æ¥è‡ª `@unhead/vue` çš„å¯¼å…¥æ›´æ”¹ä¸º `#imports` æˆ– `nuxt/app`ã€‚

```diff
-import { useHead } from '@unhead/vue'
+import { useHead } from '#imports'
```

å¦‚æœæ‚¨ä»ç„¶é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å¯ç”¨ `head.legacy` é…ç½®è¿˜åŸåˆ° v1 è¡Œä¸ºã€‚

```ts
export default defineNuxtConfig({
  unhead: {
    legacy: true,
  }
})
```

### SPA åŠ è½½å±çš„æ–° DOM ä½ç½®

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

å½“æ¸²æŸ“ä»…å®¢æˆ·ç«¯é¡µé¢ï¼ˆ`ssr: false`ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯é€‰æ‹©åœ¨ Nuxt åº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸­æ¸²æŸ“åŠ è½½å±å¹•ï¼ˆæ¥è‡ª `app/spa-loading-template.html`ï¼‰ï¼š

```html
<div id="__nuxt">
  <!-- spa loading template -->
</div>
```

ç°åœ¨ï¼Œæˆ‘ä»¬é»˜è®¤å°†æ¨¡æ¿æ¸²æŸ“åœ¨ Nuxt åº”ç”¨ç¨‹åºæ ¹ç›®å½•æ—è¾¹ï¼š

```html
<div id="__nuxt"></div>
<!-- spa loading template -->
```

#### æ›´æ”¹çš„åŸå› 

è¿™å…è®¸ SPA åŠ è½½æ¨¡æ¿åœ¨ Vue åº”ç”¨ç¨‹åºçš„æŒ‚èµ·è§£æä¹‹å‰ä¿ç•™åœ¨ DOM ä¸­ï¼Œä»è€Œé˜²æ­¢å‡ºç°ç™½è‰²é—ªçƒã€‚

#### è¿ç§»æ­¥éª¤

å¦‚æœæ‚¨ä½¿ç”¨ CSS æˆ– `document.queryElement` å®šä½ SPA åŠ è½½æ¨¡æ¿ï¼Œåˆ™éœ€è¦æ›´æ–°é€‰æ‹©å™¨ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–°çš„ `app.spaLoaderTag` å’Œ `app.spaLoaderAttrs` é…ç½®é€‰é¡¹ã€‚

æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢å¤åˆ°å…ˆå‰çš„è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    spaLoadingTemplateLocation: 'within',
  }
})
```

### æ›´ç»†ç²’åº¦çš„å†…è”æ ·å¼

ğŸš¦ **å½±å“çº§åˆ«**ï¼šé€‚ä¸­

Nuxt ç°åœ¨åªä¼šå¯¹ Vue ç»„ä»¶è¿›è¡Œå†…è”æ ·å¼ï¼Œè€Œä¸æ˜¯å…¨å±€ CSSã€‚

#### æ”¹å˜äº†ä»€ä¹ˆ

ä¹‹å‰ï¼ŒNuxt ä¼šå¯¹æ‰€æœ‰ CSS è¿›è¡Œå†…è”ï¼ŒåŒ…æ‹¬å…¨å±€æ ·å¼ï¼Œå¹¶ç§»é™¤æŒ‡å‘å•ç‹¬ CSS æ–‡ä»¶çš„ `<link>` å…ƒç´ ã€‚ç°åœ¨ï¼ŒNuxt å°†ä»…å¯¹ Vue ç»„ä»¶æ‰§è¡Œæ­¤æ“ä½œï¼ˆä¹‹å‰ä¼šç”Ÿæˆå•ç‹¬çš„ CSS å—ï¼‰ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯åœ¨å‡å°‘ç‹¬ç«‹ç½‘ç»œè¯·æ±‚ï¼ˆä¸ä¹‹å‰ä¸€æ ·ï¼Œåœ¨åˆå§‹åŠ è½½æ—¶ä¸ä¼šå¯¹æ¯ä¸ªé¡µé¢æˆ–æ¯ä¸ªç»„ä»¶åˆ†åˆ«è¯·æ±‚å•ç‹¬çš„ `.css` æ–‡ä»¶ï¼‰çš„åŒæ—¶ï¼Œä¹Ÿå…è®¸ç¼“å­˜å•ä¸ªå…¨å±€ CSS æ–‡ä»¶å¹¶å‡å°‘åˆå§‹è¯·æ±‚çš„æ–‡æ¡£ä¸‹è½½å¤§å°çš„æ›´å¥½å¹³è¡¡ã€‚

#### è¿ç§»æ­¥éª¤

æ­¤åŠŸèƒ½æ˜¯å®Œå…¨å¯é…ç½®çš„ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½® `inlineStyles: true` æ¥æ¢å¤åˆ°å…ˆå‰çš„è¡Œä¸ºï¼Œä»è€Œå°†å…¨å±€ CSS å’Œæ¯ä¸ªç»„ä»¶çš„ CSS ä¹Ÿå†…è”ã€‚

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  features: {
    inlineStyles: true
  }
})
```

### åœ¨è§£æåæ‰«æé¡µé¢å…ƒæ•°æ®

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

æˆ‘ä»¬ç°åœ¨åœ¨è°ƒç”¨ `pages:extend` é’©å­ä¹‹åæ‰«æé¡µé¢å…ƒæ•°æ®ï¼ˆåœ¨ `definePageMeta` ä¸­å®šä¹‰ï¼‰ã€‚

#### æ›´æ”¹çš„åŸå› 

è¿™æ˜¯ä¸ºäº†å…è®¸æ‰«æç”¨æˆ·å¸Œæœ›åœ¨ `pages:extend` ä¸­æ·»åŠ çš„é¡µé¢çš„å…ƒæ•°æ®ã€‚æˆ‘ä»¬ä»ç„¶æä¾›åœ¨æ–° `pages:resolved` é’©å­ä¸­æ›´æ”¹æˆ–è¦†ç›–é¡µé¢å…ƒæ•°æ®çš„æœºä¼šã€‚

#### è¿ç§»æ­¥éª¤

å¦‚æœæ‚¨æƒ³è¦†ç›–é¡µé¢å…ƒæ•°æ®ï¼Œè¯·åœ¨ `pages:resolved` ä¸­æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨ `pages:extend` ä¸­ã€‚

```diff
  export default defineNuxtConfig({
    hooks: {
-     'pages:extend'(pages) {
+     'pages:resolved'(pages) {
        const myPage = pages.find(page => page.path === '/')
        myPage.meta ||= {}
        myPage.meta.layout = 'overridden-layout'
      }
    }
  })
```

æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢å¤åˆ°å…ˆå‰çš„è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    scanPageMeta: true
  }
})
```

### å…±äº«é¢„æ¸²æŸ“æ•°æ®

ğŸš¦ **å½±å“çº§åˆ«**ï¼šä¸­ç­‰

#### æ”¹å˜äº†ä»€ä¹ˆ

æˆ‘ä»¬å¯ç”¨äº†ä¹‹å‰å®éªŒæ€§çš„åŠŸèƒ½ï¼Œä»¥åœ¨ä¸åŒé¡µé¢ä¹‹é—´å…±äº« `useAsyncData` å’Œ `useFetch` è°ƒç”¨çš„æ•°æ®ã€‚è¯·å‚è§ [åŸå§‹ PR](https://github.com/nuxt/nuxt/pull/24894)ã€‚

#### æ›´æ”¹çš„åŸå› 

æ­¤åŠŸèƒ½è‡ªåŠ¨åœ¨é¢„æ¸²æŸ“çš„é¡µé¢ä¹‹é—´å…±äº«æœ‰æ•ˆè½½è· _æ•°æ®_ã€‚å¯¹äºä½¿ç”¨ `useAsyncData` æˆ– `useFetch` å¹¶åœ¨ä¸åŒé¡µé¢ä¸­è·å–ç›¸åŒæ•°æ®çš„é¢„æ¸²æŸ“ç½‘ç«™ï¼Œè¿™å¯èƒ½ä¼šæ˜¾è‘—æ”¹å–„æ€§èƒ½ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ç½‘ç«™éœ€è¦ä¸ºæ¯ä¸ªé¡µé¢ï¼ˆä¾‹å¦‚ï¼Œè·å–èœå•çš„å¯¼èˆªæ•°æ®æˆ–æ¥è‡ª CMS çš„ç½‘ç«™è®¾ç½®ï¼‰è¯·æ±‚ `useFetch`ï¼Œåˆ™è¯¥æ•°æ®ä»…åœ¨é¢„æ¸²æŸ“ç¬¬ä¸€ä¸ªä½¿ç”¨å®ƒçš„é¡µé¢æ—¶è¯·æ±‚ä¸€æ¬¡ï¼Œç„¶åç¼“å­˜ä»¥åœ¨é¢„æ¸²æŸ“å…¶ä»–é¡µé¢æ—¶ä½¿ç”¨ã€‚

#### è¿ç§»æ­¥éª¤

ç¡®ä¿æ‚¨æ•°æ®çš„ä»»ä½•å”¯ä¸€é”®å§‹ç»ˆå¯è§£æä¸ºç›¸åŒçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ `useAsyncData` æ¥è·å–ä¸ç‰¹å®šé¡µé¢ç›¸å…³çš„æ•°æ®ï¼Œåˆ™åº”æä¾›å”¯ä¸€åŒ¹é…è¯¥æ•°æ®çš„é”®ã€‚(`useFetch` åº”è‡ªåŠ¨ä¸ºæ‚¨å®Œæˆæ­¤æ“ä½œã€‚)

```ts [app/pages/test/[slug\\].vue]
// åœ¨åŠ¨æ€é¡µé¢ï¼ˆä¾‹å¦‚ `[slug].vue`ï¼‰ä¸­ï¼Œè¿™å°†æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè·¯ç”± slug ä¼šå½±å“è·å–çš„æ•°æ®ï¼Œä½† Nuxt æ— æ³•çŸ¥é“ï¼Œå› ä¸ºå®ƒæœªåæ˜ åœ¨é”®ä¸­ã€‚
const route = useRoute()
const { data } = await useAsyncData(async () => {
  return await $fetch(`/api/my-page/${route.params.slug}`)
})
// ç›¸åï¼Œæ‚¨åº”è¯¥ä½¿ç”¨å”¯ä¸€æ ‡è¯†æ‰€è·å–æ•°æ®çš„é”®ã€‚
const { data } = await useAsyncData(route.params.slug, async () => {
  return await $fetch(`/api/my-page/${route.params.slug}`)
})
```

æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¦ç”¨æ­¤åŠŸèƒ½ï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    sharedPrerenderData: false
  }
})
```

### åœ¨ `useAsyncData` å’Œ `useFetch` ä¸­çš„é»˜è®¤ `data` å’Œ `error` å€¼

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

`useAsyncData` è¿”å›çš„ `data` å’Œ `error` å¯¹è±¡ç°åœ¨å°†é»˜è®¤å€¼ä¸º `undefined`ã€‚

#### æ›´æ”¹çš„åŸå› 

ä¹‹å‰ `data` è¢«åˆå§‹åŒ–ä¸º `null`ï¼Œä½†åœ¨ `clearNuxtData` ä¸­é‡ç½®ä¸º `undefined`ã€‚`error` åˆå§‹åŒ–ä¸º `null`ã€‚æ­¤æ›´æ”¹æ˜¯ä¸ºäº†å®ç°æ›´å¤§çš„ä¸€è‡´æ€§ã€‚

#### è¿ç§»æ­¥éª¤

å¦‚æœæ‚¨æ£€æŸ¥ `data.value` æˆ– `error.value` æ˜¯å¦ä¸º `null`ï¼Œå¯ä»¥æ›´æ–°è¿™äº›æ£€æŸ¥ä»¥æ£€æŸ¥ `undefined`ã€‚

::tip
æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/default-data-error-value` è‡ªåŠ¨åŒ–æ­¤æ­¥éª¤
::

å¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢å¤åˆ°å…ˆå‰çš„è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
// @errors: 2353
export default defineNuxtConfig({
  experimental: {
    defaults: {
      useAsyncData: {
        value: 'null',
        errorValue: 'null'
      }
    }
  }
})
```

è¯·æŠ¥å‘Šæ­¤é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—å°†å…¶ä¿æŒä¸ºå¯é…ç½®ã€‚

### ç§»é™¤åœ¨ `useAsyncData` å’Œ `useFetch` ä¸­è°ƒç”¨ `refresh` æ—¶è¿‡æ—¶çš„ `boolean` å€¼çš„ `dedupe` é€‰é¡¹

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

ä¹‹å‰å¯ä»¥å‘ `refresh` ä¼ é€’ `dedupe: boolean`ã€‚è¿™äº›å‚æ•°æ˜¯ `cancel`ï¼ˆ`true`ï¼‰å’Œ `defer`ï¼ˆ`false`ï¼‰çš„åˆ«åã€‚

```ts twoslash [app.vue]
// @errors: 2322
const { refresh } = await useAsyncData(async () => ({ message: 'Hello, Nuxt!' }))

async function refreshData () {
  await refresh({ dedupe: true })
}
```

#### æ›´æ”¹çš„åŸå› 

è¿™äº›åˆ«åè¢«ç§»é™¤ï¼Œä»¥æé«˜æ¸…æ™°åº¦ã€‚

è¿™ä¸ªé—®é¢˜å‡ºç°åœ¨å°† `dedupe` æ·»åŠ å…¥ `useAsyncData` çš„é€‰é¡¹æ—¶ï¼Œæˆ‘ä»¬åˆ é™¤äº†å¸ƒå°”å€¼ï¼Œå› ä¸ºå®ƒä»¬æœ€ç»ˆæˆä¸ºäº†_ç›¸å¯¹çš„_ã€‚

`refresh({ dedupe: false })` æ„å‘³ç€â€œä¸å–æ¶ˆç°æœ‰è¯·æ±‚ä»¥ä¼˜å…ˆè€ƒè™‘æ­¤æ–°è¯·æ±‚â€ã€‚è€Œåœ¨ `useAsyncData` çš„é€‰é¡¹ä¸­ä¼ é€’ `dedupe: true` æ„å‘³ç€ â€œå¦‚æœæœ‰ç°æœ‰çš„å¾…å¤„ç†è¯·æ±‚åˆ™ä¸è¿›è¡Œä»»ä½•æ–°è¯·æ±‚â€ã€‚ï¼ˆè¯·å‚è§ [PR](https://github.com/nuxt/nuxt/pull/24564#pullrequestreview-1764584361)ï¼‰ã€‚

#### è¿ç§»æ­¥éª¤

è¿ç§»åº”è¯¥æ˜¯ç›´æ¥çš„ï¼š

```diff
  const { refresh } = await useAsyncData(async () => ({ message: 'Hello, Nuxt 3!' }))
  
  async function refreshData () {
-   await refresh({ dedupe: true })
+   await refresh({ dedupe: 'cancel' })

-   await refresh({ dedupe: false })
+   await refresh({ dedupe: 'defer' })
  }
```

::tip
æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/deprecated-dedupe-value` è‡ªåŠ¨åŒ–æ­¤æ­¥éª¤
::

### åœ¨ `useAsyncData` å’Œ `useFetch` ä¸­æ¸…é™¤ `data` æ—¶éµå¾ªé»˜è®¤å€¼

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

å¦‚æœæ‚¨ä¸º `useAsyncData` æä¾›è‡ªå®šä¹‰ `default` å€¼ï¼Œåœ¨è°ƒç”¨ `clear` æˆ– `clearNuxtData` æ—¶ç°åœ¨å°†ä½¿ç”¨æ­¤å€¼ï¼Œå¹¶å°†å…¶é‡ç½®ä¸ºè¯¥é»˜è®¤å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯æœªè®¾ç½®ã€‚

#### æ›´æ”¹çš„åŸå› 

ç”¨æˆ·é€šå¸¸è®¾ç½®é€‚å½“çš„ç©ºå€¼ï¼Œä¾‹å¦‚ç©ºæ•°ç»„ï¼Œä»¥é¿å…åœ¨è¿­ä»£æ—¶æ£€æŸ¥ `null`/`undefined`ã€‚åœ¨é‡ç½®/æ¸…é™¤æ•°æ®æ—¶åº”å°Šé‡è¿™ä¸€ç‚¹ã€‚

#### è¿ç§»æ­¥éª¤

å¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥æš‚æ—¶é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢å¤åˆ°å…ˆå‰çš„è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
// @errors: 2353
export default defineNuxtConfig({
  experimental: {
    resetAsyncDataToUndefined: true,
  }
})
```

è¯·æŠ¥å‘Šæ­¤é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—å°†å…¶ä¿æŒä¸ºå¯é…ç½®ã€‚

### `useAsyncData` å’Œ `useFetch` ä¸­çš„è¡¨é¢æ•°æ®å“åº”æ€§

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

ä» `useAsyncData`ã€`useFetch`ã€`useLazyAsyncData` å’Œ `useLazyFetch` è¿”å›çš„ `data` å¯¹è±¡ç°åœ¨æ˜¯ `shallowRef` è€Œä¸æ˜¯ `ref`ã€‚

#### æ”¹å˜äº†ä»€ä¹ˆ

å½“è·å–æ–°æ•°æ®æ—¶ï¼Œä»»ä½•ä¾èµ–äº `data` çš„å†…å®¹ä»å°†æ˜¯å“åº”å¼çš„ï¼Œå› ä¸ºæ•´ä¸ªå¯¹è±¡è¢«æ›¿æ¢ã€‚ä½†å¦‚æœæ‚¨çš„ä»£ç æ›´æ”¹äº†è¯¥æ•°æ®ç»“æ„ä¸­çš„æŸä¸ªå±æ€§ï¼Œåˆ™ä¸ä¼šè§¦å‘åº”ç”¨ä¸­çš„ä»»ä½•å“åº”æ€§ã€‚

#### æ›´æ”¹çš„åŸå› 

è¿™ä¸ºæ·±åº¦åµŒå¥—å¯¹è±¡å’Œæ•°ç»„å¸¦æ¥äº†**æ˜¾è‘—**çš„æ€§èƒ½æ”¹è¿›ï¼Œå› ä¸º Vue ä¸éœ€è¦ç›‘è§†æ¯ä¸ªå•ç‹¬çš„å±æ€§/æ•°ç»„çš„ä¿®æ”¹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ`data` ä¹Ÿåº”è¯¥æ˜¯ä¸å¯å˜çš„ã€‚

#### è¿ç§»æ­¥éª¤

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸éœ€è¦è¿ç§»æ­¥éª¤ï¼Œä½†å¦‚æœæ‚¨ä¾èµ–äº data å¯¹è±¡çš„å“åº”æ€§ï¼Œåˆ™æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š

1. æ‚¨å¯ä»¥æ ¹æ®æ¯ä¸ªç»„åˆçš„éœ€æ±‚é€‰æ‹©æ·±å…¥å“åº”æ€§ï¼š
   ```diff
   - const { data } = useFetch('/api/test')
   + const { data } = useFetch('/api/test', { deep: true })
   ```
2. æ‚¨å¯ä»¥åœ¨æ•´ä¸ªé¡¹ç›®èŒƒå›´å†…æ›´æ”¹é»˜è®¤è¡Œä¸ºï¼ˆä¸æ¨èï¼‰ï¼š
   ```ts twoslash [nuxt.config.ts]
   export default defineNuxtConfig({
     experimental: {
       defaults: {
         useAsyncData: {
           deep: true
         }
       }
     }
   })
   ```

::tip
å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/shallow-function-reactivity` è‡ªåŠ¨åŒ–æ­¤æ­¥éª¤
::

### åœ¨ `builder:watch` ä¸­ä½¿ç”¨ç»å¯¹ç›‘è§†è·¯å¾„

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

Nuxt `builder:watch` é’©å­ç°åœ¨å‘å‡ºçš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯ç›¸å¯¹äºæ‚¨é¡¹ç›® `srcDir` çš„è·¯å¾„ã€‚

#### æ›´æ”¹çš„åŸå› 

è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ”¯æŒç›‘è§†ä½äº `srcDir` ä¹‹å¤–çš„è·¯å¾„ï¼Œå¹¶ä¸ºå›¾å±‚å’Œå…¶ä»–æ›´å¤æ‚çš„æ¨¡å¼æä¾›æ›´å¥½çš„æ”¯æŒã€‚

#### è¿ç§»æ­¥éª¤

æˆ‘ä»¬å·²ç»ç§¯æè¿ç§»äº†æˆ‘ä»¬çŸ¥é“ä½¿ç”¨æ­¤é’©å­çš„å…¬å…± Nuxt æ¨¡å—ã€‚è¯·å‚è§ [é—®é¢˜ #25339](https://github.com/nuxt/nuxt/issues/25339)ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æ˜¯æ¨¡å—ä½œè€…å¹¶ä½¿ç”¨ `builder:watch` é’©å­ï¼Œå¹¶å¸Œæœ›ä¿æŒå‘å/å‘å‰å…¼å®¹æ€§ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¡®ä¿æ‚¨çš„ä»£ç åœ¨ Nuxt v3 å’Œ Nuxt v4 ä¸­æ­£å¸¸å·¥ä½œï¼š

```diff
+ import { relative, resolve } from 'node:fs'
  // ...
  nuxt.hook('builder:watch', async (event, path) => {
+   path = relative(nuxt.options.srcDir, resolve(nuxt.options.srcDir, path))
    // ...
  })
```

::tip
æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/absolute-watch-path` è‡ªåŠ¨åŒ–æ­¤æ­¥éª¤
::

### ç§»é™¤ `window.__NUXT__` å¯¹è±¡

#### æ”¹å˜äº†ä»€ä¹ˆ

æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºå®Œæˆæ°´åˆåç§»é™¤å…¨å±€ `window.__NUXT__` å¯¹è±¡ã€‚

#### æ›´æ”¹çš„åŸå› 

è¿™ä¸ºå¤šåº”ç”¨æ¨¡å¼å¼€è¾Ÿäº†é“è·¯ï¼ˆ[#21635](https://github.com/nuxt/nuxt/issues/21635)ï¼‰ï¼Œå¹¶ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºä¸€ç§è®¿é—® Nuxt åº”ç”¨ç¨‹åºæ•°æ®çš„æ–¹å¼ - `useNuxtApp()`ã€‚

#### è¿ç§»æ­¥éª¤

æ•°æ®ä»ç„¶å¯ç”¨ï¼Œä½†å¯ä»¥é€šè¿‡ `useNuxtApp().payload` è®¿é—®ï¼š

```diff
- console.log(window.__NUXT__)
+ console.log(useNuxtApp().payload)
```

### ç›®å½•ç´¢å¼•æ‰«æ

ğŸš¦ **å½±å“çº§åˆ«**ï¼šä¸­ç­‰

#### æ”¹å˜äº†ä»€ä¹ˆ

æ‚¨çš„ `middleware/` æ–‡ä»¶å¤¹ä¸­çš„å­æ–‡ä»¶å¤¹ä¹Ÿä¼šæ‰«æ `index` æ–‡ä»¶ï¼Œå¹¶ä¸”è¿™äº›ç°åœ¨ä¹Ÿä½œä¸ºä¸­é—´ä»¶åœ¨æ‚¨çš„é¡¹ç›®ä¸­æ³¨å†Œã€‚

#### æ›´æ”¹çš„åŸå› 

Nuxt è‡ªåŠ¨æ‰«æå¤šä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬ `middleware/` å’Œ `plugins/`ã€‚

æˆ‘ä»¬å¸Œæœ› `plugins/` æ–‡ä»¶å¤¹ä¸­çš„å­æ–‡ä»¶å¤¹ä¹Ÿèƒ½æ‰«æ `index` æ–‡ä»¶ï¼Œä»¥ä½¿æ­¤è¡Œä¸ºåœ¨è¢«æ‰«æçš„ç›®å½•ä¹‹é—´ä¿æŒä¸€è‡´ã€‚

#### è¿ç§»æ­¥éª¤

å¤§æ¦‚æ— éœ€è¿ç§»ï¼Œä½†å¦‚æœæ‚¨å¸Œæœ›æ¢å¤åˆ°ä¹‹å‰çš„è¡Œä¸ºï¼Œå¯ä»¥æ·»åŠ é’©å­ä»¥è¿‡æ»¤æ‰è¿™äº›ä¸­é—´ä»¶ï¼š

```ts
export default defineNuxtConfig({
  hooks: {
    'app:resolve'(app) {
      app.middleware = app.middleware.filter(mw => !/\/index\.[^/]+$/.test(mw.path))
    }
  }
})
```

### æ¨¡æ¿ç¼–è¯‘æ›´æ”¹

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

ä¹‹å‰ï¼ŒNuxt ä½¿ç”¨ `lodash/template` ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿä¸Šä½äº `.ejs` æ–‡ä»¶æ ¼å¼/è¯­æ³•ä¸­çš„æ¨¡æ¿ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€äº›æ¨¡æ¿å®ç”¨ç¨‹åº (`serialize`ã€`importName`ã€`importSources`)ï¼Œè¿™å¯ä»¥åœ¨è¿™äº›æ¨¡æ¿ä¸­ç”¨äºä»£ç ç”Ÿæˆï¼Œç°åœ¨å°†è¢«ç§»é™¤ã€‚

#### æ›´æ”¹çš„åŸå› 

åœ¨ Nuxt v3 ä¸­ï¼Œæˆ‘ä»¬è½¬å‘äº†ä¸€ç§â€œè™šæ‹Ÿâ€è¯­æ³•ï¼Œé€šè¿‡ `getContents()` å‡½æ•°ï¼Œè¿™ç§æ–¹å¼æ›´çµæ´»ä¸”æ€§èƒ½æ›´å¥½ã€‚

æ­¤å¤–ï¼Œ`lodash/template` å·²å‘ç”Ÿä¸€ç³»åˆ—å®‰å…¨é—®é¢˜ã€‚è¿™äº›é—®é¢˜å®é™…ä¸Šå¹¶ä¸é€‚ç”¨äº Nuxt é¡¹ç›®ï¼Œå› ä¸ºå®ƒåœ¨æ„å»ºæ—¶è€Œä¸æ˜¯è¿è¡Œæ—¶ä½¿ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯å—ä¿¡ä»£ç ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä»ç„¶å‡ºç°åœ¨å®‰å…¨å®¡è®¡ä¸­ã€‚æ­¤å¤–ï¼Œ`lodash` æ˜¯ä¸€ä¸ªåºå¤§çš„ä¾èµ–ï¼Œå¹¶ä¸”å¤§å¤šæ•°é¡¹ç›®æœªä½¿ç”¨å®ƒã€‚

æœ€åï¼Œç›´æ¥åœ¨ Nuxt ä¸­æä¾›ä»£ç åºåˆ—åŒ–åŠŸèƒ½å¹¶ä¸ç†æƒ³ã€‚ç›¸åï¼Œæˆ‘ä»¬ç»´æŠ¤åƒ [unjs/knitwork](http://github.com/unjs/knitwork) è¿™æ ·çš„é¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®å¯ä»¥ä½œä¸ºæ‚¨é¡¹ç›®çš„ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶ä¸­ç›´æ¥æŠ¥å‘Š/è§£å†³å®‰å…¨é—®é¢˜ï¼Œè€Œæ— éœ€å‡çº§ Nuxt æœ¬èº«ã€‚

#### è¿ç§»æ­¥éª¤

æˆ‘ä»¬å·²ç»æå‡º PR æ›´æ–°ä½¿ç”¨ EJS è¯­æ³•çš„æ¨¡å—ï¼Œä½†å¦‚æœæ‚¨éœ€è¦è‡ªå·±æ‰§è¡Œæ­¤æ“ä½œï¼Œæ‚¨æœ‰ä¸‰ä¸ªå‘å/å‘å‰å…¼å®¹çš„æ›¿ä»£æ–¹æ¡ˆï¼š

* å°†å­—ç¬¦ä¸²æ’å€¼é€»è¾‘ç›´æ¥ç§»å…¥ `getContents()`ã€‚
* ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°å¤„ç†æ›¿æ¢ï¼Œä¾‹å¦‚ä½¿ç”¨ https://github.com/nuxt-modules/color-mode/pull/240ã€‚
* ä½¿ç”¨ `es-toolkit/compat`ï¼ˆ`lodash` æ¨¡æ¿çš„æ›¿ä»£å“ï¼‰ï¼Œä½œä¸ºæ‚¨é¡¹ç›®çš„ä¾èµ–ï¼Œè€Œä¸æ˜¯ Nuxtï¼š

```diff
+ import { readFileSync } from 'node:fs'
+ import { template } from 'es-toolkit/compat'
  // ...
  addTemplate({
    fileName: 'appinsights-vue.js'
    options: { /* some options */ },
-   src: resolver.resolve('./runtime/plugin.ejs'),
+   getContents({ options }) {
+     const contents = readFileSync(resolver.resolve('./runtime/plugin.ejs'), 'utf-8')
+     return template(contents)({ options })
+   },
  })
```

æœ€åï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨æ¨¡æ¿å®ç”¨ç¨‹åº (`serialize`ã€`importName`ã€`importSources`)ï¼Œå¯ä»¥ä½¿ç”¨ `knitwork` ä¸­çš„å®ç”¨ç¨‹åºæ›¿æ¢å®ƒä»¬ï¼š

```ts
import { genDynamicImport, genImport, genSafeVariableName } from 'knitwork'

const serialize = (data: any) => JSON.stringify(data, null, 2).replace(/"{(.+)}"(?=,?$)/gm, r => JSON.parse(r).replace(/^{(.*)}$/, '$1'))

const importSources = (sources: string | string[], { lazy = false } = {}) => {
  return toArray(sources).map((src) => {
    if (lazy) {
      return `const ${genSafeVariableName(src)} = ${genDynamicImport(src, { comment: `webpackChunkName: ${JSON.stringify(src)}` })}`
    }
    return genImport(src, genSafeVariableName(src))
  }).join('\n')
}

const importName = genSafeVariableName
```

::tip
æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/template-compilation-changes` è‡ªåŠ¨åŒ–æ­¤æ­¥éª¤
::

### ç§»é™¤å®éªŒæ€§åŠŸèƒ½

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ”¹å˜äº†ä»€ä¹ˆ

å››ä¸ªå®éªŒæ€§åŠŸèƒ½åœ¨ Nuxt 4 ä¸­ä¸å†å¯é…ç½®ï¼š

* `experimental.treeshakeClientOnly` å°†ä¸º `true`ï¼ˆè‡ª v3.0 èµ·é»˜è®¤ï¼‰
* `experimental.configSchema` å°†ä¸º `true`ï¼ˆè‡ª v3.3 èµ·é»˜è®¤ï¼‰
* `experimental.polyfillVueUseHead` å°†ä¸º `false`ï¼ˆè‡ª v3.4 èµ·é»˜è®¤ï¼‰
* `experimental.respectNoSSRHeader` å°†ä¸º `false`ï¼ˆè‡ª v3.4 èµ·é»˜è®¤ï¼‰
* `vite.devBundler` ä¸å†å¯é…ç½® - é»˜è®¤å°†ä½¿ç”¨ `vite-node`

#### æ›´æ”¹çš„åŸå› 

è¿™äº›é€‰é¡¹å·²ç»è®¾ç½®ä¸ºå½“å‰å€¼æœ‰ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬æ²¡æœ‰ç†ç”±ç›¸ä¿¡å®ƒä»¬éœ€è¦ä¿æŒå¯é…ç½®ã€‚

#### è¿ç§»æ­¥éª¤

* `polyfillVueUseHead` å¯ä»¥é€šè¿‡ [æ­¤æ’ä»¶](https://github.com/nuxt/nuxt/blob/f209158352b09d1986aa320e29ff36353b91c358/packages/nuxt/src/head/runtime/plugins/vueuse-head-polyfill.ts#L10-L11) åœ¨ç”¨æˆ·ç«¯å®ç°ã€‚

* `respectNoSSRHeader` å¯ä»¥é€šè¿‡ [æœåŠ¡å™¨ä¸­é—´ä»¶](https://github.com/nuxt/nuxt/blob/c660b39447f0d5b8790c0826092638d321cd6821/packages/nuxt/src/core/runtime/nitro/no-ssr.ts#L8-L9) åœ¨ç”¨æˆ·ç«¯å®ç°ã€‚

## Nuxt 2 ä¸ Nuxt 3+

åœ¨ä¸‹è¡¨ä¸­ï¼Œæœ‰å…³ Nuxt ä¸‰ä¸ªç‰ˆæœ¬çš„å¿«é€Ÿæ¯”è¾ƒï¼š

ç‰¹æ€§ / ç‰ˆæœ¬        | Nuxt 2          | Nuxt Bridge      | Nuxt 3+
-------------------------|-----------------|------------------|---------
Vue                      | 2               | 2                | 3
ç¨³å®šæ€§                | ğŸ˜Š ç¨³å®š      | ğŸ˜Š ç¨³å®š         | ğŸ˜Š ç¨³å®š
æ€§èƒ½              | ğŸ å¿«        | âœˆï¸ æ›´å¿«          | ğŸš€ æœ€å¿«
Nitro å¼•æ“             | âŒ             | âœ…                | âœ…
ESM æ”¯æŒ              | ğŸŒ™ éƒ¨åˆ†     | ğŸ‘ æ›´å¥½         | âœ…
TypeScript               | â˜‘ï¸ é€‰æ‹©æ€§       | ğŸš§ éƒ¨åˆ†        | âœ…
ç»„åˆ API          | âŒ             | ğŸš§ éƒ¨åˆ†        | âœ…
é€‰é¡¹ API              | âœ…             | âœ…                | âœ…
ç»„ä»¶è‡ªåŠ¨å¯¼å…¥   | âœ…             | âœ…                | âœ…
`<script setup>` è¯­æ³•  | âŒ             | ğŸš§ éƒ¨åˆ†        | âœ…
è‡ªåŠ¨å¯¼å…¥             | âŒ             | âœ…                | âœ…
webpack                  | 4              | 4                 | 5
Vite                     | âš ï¸ éƒ¨åˆ†      | ğŸš§ éƒ¨åˆ†        | âœ…
Nuxi CLI                 | âŒ æ—§         | âœ… nuxi           | âœ… nuxi
é™æ€ç½‘ç«™             | âœ…             | âœ…                | âœ…

## ä» Nuxt 2 å‡çº§åˆ° Nuxt 3+

è¿ç§»æŒ‡å—æä¾›äº† Nuxt 2 ç‰¹æ€§ä¸ Nuxt 3+ ç‰¹æ€§çš„é€æ­¥æ¯”è¾ƒï¼Œå¹¶æä¾›é€‚åº”æ‚¨å½“å‰åº”ç”¨ç¨‹åºçš„æŒ‡å¯¼ã€‚

::read-more{to="/docs/migration/overview"}
æŸ¥çœ‹ **ä» Nuxt 2 è¿ç§»åˆ° Nuxt 3 çš„æŒ‡å—**ã€‚
::

## ä» Nuxt 2 è¿ç§»åˆ° Nuxt Bridge

å¦‚æœæ‚¨æ›´å–œæ¬¢é€æ­¥å°†æ‚¨çš„ Nuxt 2 åº”ç”¨ç¨‹åºè¿ç§»åˆ° Nuxt 3ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Nuxt Bridgeã€‚Nuxt Bridge æ˜¯ä¸€ä¸ªå…¼å®¹å±‚ï¼Œå…è®¸æ‚¨åœ¨ Nuxt 2 ä¸­ä½¿ç”¨ Nuxt 3+ ç‰¹æ€§ï¼Œé€šè¿‡é€‰æ‹©åŠ å…¥çš„æœºåˆ¶ã€‚

::read-more{to="/docs/bridge/overview"}
**ä» Nuxt 2 è¿ç§»åˆ° Nuxt Bridge**
::