---
title: å‡çº§æŒ‡å—
description: 'äº†è§£å¦‚ä½•å‡çº§åˆ°æœ€æ–°çš„ Nuxt ç‰ˆæœ¬ã€‚'
navigation.icon: i-lucide-circle-arrow-up
---

## å‡çº§ Nuxt

### æœ€æ–°ç‰ˆæœ¬

è¦å°† Nuxt å‡çº§åˆ°[æœ€æ–°ç‰ˆæœ¬](https://github.com/nuxt/nuxt/releases)ï¼Œè¯·ä½¿ç”¨ `nuxt upgrade` å‘½ä»¤ã€‚

::code-group{sync="pm"}

```bash [npm]
npx nuxt upgrade
```

```bash [yarn]
yarn nuxt upgrade
```

```bash [pnpm]
pnpm nuxt upgrade
```

```bash [bun]
bun x nuxt upgrade
```

::

### æ¯æ—¥æ„å»ºç‰ˆæœ¬æ¸ é“

è¦åœ¨æ–°ç‰¹æ€§å‘å¸ƒå‰ä½¿ç”¨æœ€æ–°çš„ Nuxt æ„å»ºå¹¶è¿›è¡Œæµ‹è¯•ï¼Œè¯·é˜…è¯» [æ¯æ—¥æ„å»ºç‰ˆæœ¬æ¸ é“](/docs/3.x/guide/going-further/nightly-release-channel) æŒ‡å—ã€‚

::warning
æ¯æ—¥æ„å»ºç‰ˆæœ¬æ¸ é“ `latest` æ ‡ç­¾ç›®å‰è·Ÿè¸ª Nuxt v4 åˆ†æ”¯ï¼Œè¿™æ„å‘³ç€ç°åœ¨ç‰¹åˆ«å¯èƒ½å­˜åœ¨ç ´åæ€§æ›´æ”¹ â€”â€” è¯·åŠ¡å¿…å°å¿ƒï¼ä½ å¯ä»¥é€šè¿‡ `"nuxt": "npm:nuxt-nightly@3x"` é€‰æ‹©ä½¿ç”¨ 3.x åˆ†æ”¯çš„æ¯æ—¥æ„å»ºç‰ˆæœ¬ã€‚
::

## æµ‹è¯• Nuxt 4

Nuxt 4 **è®¡åˆ’äº 2025 å¹´ç¬¬äºŒå­£åº¦å‘å¸ƒ**ã€‚å®ƒå°†åŒ…å«æ‰€æœ‰å½“å‰é€šè¿‡ `compatibilityVersion: 4` å¯ç”¨çš„åŠŸèƒ½ã€‚

åœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œå¯ä»¥ä» Nuxt 3.12 ç‰ˆæœ¬å¼€å§‹æµ‹è¯•è®¸å¤š Nuxt 4 çš„ç ´åæ€§æ›´æ”¹ã€‚

:video-accordion{title="è§‚çœ‹ Alexander Lichter ä»‹ç»å¦‚ä½•é€‰æ‹© Nuxt 4 ç ´åæ€§æ›´æ”¹çš„è§†é¢‘" videoId="r4wFKlcJK6c"}

### é€‰æ‹©ä½¿ç”¨ Nuxt 4

é¦–å…ˆï¼Œå°† Nuxt å‡çº§åˆ°[æœ€æ–°ç‰ˆæœ¬](https://github.com/nuxt/nuxt/releases)ã€‚

ç„¶åï¼Œä½ å¯ä»¥è®¾ç½® `compatibilityVersion` æ¥åŒ¹é… Nuxt 4 çš„è¡Œä¸ºï¼š

::code-collapse
```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  future: {
    compatibilityVersion: 4,
  },
  // è‹¥è¦é‡æ–°å¯ç”¨ _å…¨éƒ¨_ Nuxt v3 çš„è¡Œä¸ºï¼Œè¯·è®¾ç½®ä»¥ä¸‹é€‰é¡¹ï¼š
  // srcDir: '.',
  // dir: {
  //   app: 'app'
  // },
  // experimental: {
  //   scanPageMeta: 'after-resolve',
  //   sharedPrerenderData: false,
  //   compileTemplate: true,
  //   resetAsyncDataToUndefined: true,
  //   templateUtils: true,
  //   relativeWatchPaths: true,
  //   normalizeComponentNames: false,
  //   spaLoadingTemplateLocation: 'within',
  //   parseErrorData: false,
  //   pendingWhenIdle: true,
  //   alwaysRunFetchOnKeyChange: true,
  //   defaults: {
  //     useAsyncData: {
  //       deep: true
  //     }
  //   }
  // },
  // features: {
  //   inlineStyles: true
  // },
  // unhead: {
  //   renderSSRHeadOptions: {
  //     omitLineBreaks: false
  //   }
  // }
})
```
::

::note
ç›®å‰ï¼Œä½ éœ€è¦åœ¨æ¯ä¸ªé€‰æ‹© Nuxt 4 è¡Œä¸ºçš„å±‚å†…å®šä¹‰ `compatibilityVersion`ã€‚åœ¨ Nuxt 4 å‘å¸ƒåï¼Œå°†ä¸å†éœ€è¦è¿™æ ·åšã€‚
::

å½“ä½ å°† `compatibilityVersion` è®¾ç½®ä¸º `4` æ—¶ï¼ŒNuxt é…ç½®ä¸­çš„é»˜è®¤å€¼å°†æ›´æ”¹ä»¥é€‚åº” Nuxt v4 è¡Œä¸ºï¼Œä½†ä½ å¯ä»¥æ ¹æ®ä¸Šé¢æ³¨é‡Šçš„è¡Œå†…å®¹ï¼Œåœ¨æµ‹è¯•ä¸­é€æ­¥é‡æ–°å¯ç”¨ Nuxt v3 çš„è¡Œä¸ºã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æäº¤ issueï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨ Nuxt æˆ–ç”Ÿæ€ç³»ç»Ÿä¸­ä¿®å¤ã€‚

é‡å¤§æˆ–ç ´åæ€§å˜æ›´å°†ä¼šåœ¨è¿™é‡Œè¿›è¡Œè¯´æ˜ï¼Œå¹¶æä¾›å‘å‰/å‘åå…¼å®¹çš„è¿ç§»æ­¥éª¤ã€‚

::note
æ­¤éƒ¨åˆ†å†…å®¹ç›´åˆ°æœ€ç»ˆå‘å¸ƒå‰å¯èƒ½ä¼šæœ‰å˜åŒ–ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ `compatibilityVersion: 4` æµ‹è¯• Nuxt 4ï¼Œè¯·å®šæœŸå›æ¥æŸ¥çœ‹ã€‚
::

### ä½¿ç”¨ Codemods è¿ç§»

ä¸ºäº†ç®€åŒ–å‡çº§æµç¨‹ï¼Œæˆ‘ä»¬ä¸ [Codemod](https://github.com/codemod-com/codemod) å›¢é˜Ÿåˆä½œï¼Œæä¾›äº†ä¸€äº›å¼€æºçš„ä»£ç è½¬æ¢å·¥å…·ï¼ˆcodemodsï¼‰æ¥è‡ªåŠ¨æ‰§è¡Œè®¸å¤šè¿ç§»æ­¥éª¤ã€‚

::note
å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·é€šè¿‡ `npx codemod feedback` å‘ Codemod å›¢é˜Ÿåé¦ˆ ğŸ™
::

æœ‰å…³å®Œæ•´çš„ Nuxt 4 codemods åˆ—è¡¨ã€æ¯ä¸ªå·¥å…·çš„è¯¦ç»†ä¿¡æ¯ã€æºç å’Œå¤šç§è¿è¡Œæ–¹å¼ï¼Œè¯·è®¿é—® [Codemod æ³¨å†Œè¡¨](https://go.codemod.com/codemod-registry)ã€‚

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ `codemod` å‘½ä»¤æ‰§è¡Œæœ¬æŒ‡å—ä¸­æåˆ°çš„æ‰€æœ‰ codemodsï¼š

::code-group

```bash [npm]
# Using pinned version due to https://github.com/codemod-com/codemod/issues/1710
npx codemod@0.18.7 nuxt/4/migration-recipe
```

```bash [yarn]
# Using pinned version due to https://github.com/codemod-com/codemod/issues/1710
yarn dlx codemod@0.18.7 nuxt/4/migration-recipe
```

```bash [pnpm]
# Using pinned version due to https://github.com/codemod-com/codemod/issues/1710
pnpm dlx codemod@0.18.7 nuxt/4/migration-recipe
```

```bash [bun]
# Using pinned version due to https://github.com/codemod-com/codemod/issues/1710
bun x codemod@0.18.7 nuxt/4/migration-recipe
```

::

è¯¥å‘½ä»¤å°†ä¼šæŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰ codemodsï¼Œä½ è¿˜å¯ä»¥é€‰æ‹©ä¸æ‰§è¡ŒæŸäº›ä¸æƒ³è¿è¡Œçš„ï¼›æ¯ä¸ª codemod ä¹Ÿåœ¨ä¸‹æ–‡åˆ—å‡ºï¼Œå¹¶å¯å•ç‹¬è¿è¡Œã€‚

### æ–°çš„ç›®å½•ç»“æ„

ğŸš¦ **å½±å“ç­‰çº§**ï¼šé‡å¤§

Nuxt é»˜è®¤é‡‡ç”¨æ–°çš„ç›®å½•ç»“æ„ï¼Œä½†ä¿æŒå‘åå…¼å®¹ï¼ˆå¦‚æœ Nuxt æ£€æµ‹åˆ°ä½ ä½¿ç”¨çš„æ˜¯æ—§ç»“æ„ï¼Œæ¯”å¦‚é¡¶çº§çš„ `pages/` ç›®å½•ï¼Œåˆ™ä¸ä¼šåº”ç”¨è¿™ä¸ªæ–°ç»“æ„ï¼‰ã€‚

ğŸ‘‰ [æŸ¥çœ‹å®Œæ•´çš„ RFC](https://github.com/nuxt/nuxt/issues/26444)

#### å˜åŒ–å†…å®¹

* æ–°çš„ Nuxt é»˜è®¤ `srcDir` ç°åœ¨æ˜¯ `app/`ï¼Œå¤§éƒ¨åˆ†å†…å®¹éƒ½ä»è¿™é‡Œè§£æã€‚
* `serverDir` é»˜è®¤ä» `<rootDir>/server` è€Œé `<srcDir>/server`
* `layers/`ã€`modules/` å’Œ `public/` ç›®å½•é»˜è®¤ç›¸å¯¹äº `<rootDir>` è§£æ
* å¦‚æœä½¿ç”¨ [Nuxt Content v2.13+](https://github.com/nuxt/content/pull/2649)ï¼Œ`content/` ç›¸å¯¹äº `<rootDir>` è§£æ
* æ–°å¢ `dir.app`ï¼Œè¿™æ˜¯å¯»æ‰¾ `router.options.ts` å’Œ `spa-loading-template.html` çš„ç›®å½•ï¼Œé»˜è®¤æ˜¯ `<srcDir>/`

<details>

<summary>ç¤ºä¾‹ v4 æ–‡ä»¶å¤¹ç»“æ„</summary>

```sh
.output/
.nuxt/
app/
  assets/
  components/
  composables/
  layouts/
  middleware/
  pages/
  plugins/
  utils/
  app.config.ts
  app.vue
  router.options.ts
content/
layers/
modules/
node_modules/
public/
shared/
server/
  api/
  middleware/
  plugins/
  routes/
  utils/
nuxt.config.ts
```

</details>

ğŸ‘‰ è¯¦æƒ…å¯è§ [å®ç°æ­¤å˜æ›´çš„ PR](https://github.com/nuxt/nuxt/pull/27029)ã€‚

#### å˜æ›´åŸå› 

1. **æ€§èƒ½** - æŠŠä»£ç å…¨éƒ¨æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¼šå¯¼è‡´ `.git/` å’Œ `node_modules/` æ–‡ä»¶å¤¹è¢«æ–‡ä»¶ç³»ç»Ÿç›‘å¬å™¨æ‰«æ/åŒ…å«ï¼Œè¿™å¯èƒ½åœ¨é macOS ç³»ç»Ÿä¸Šæ˜¾è‘—å»¶é•¿å¯åŠ¨æ—¶é—´ã€‚
2. **IDE ç±»å‹å®‰å…¨** - `server/` ç›®å½•ä¸åº”ç”¨å…¶ä½™éƒ¨åˆ†è¿è¡Œåœ¨ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œæ‹¥æœ‰ä¸åŒçš„å…¨å±€å¯¼å…¥ã€‚ç¡®ä¿ `server/` ä¸åœ¨åº”ç”¨ç¨‹åºå…¶ä½™éƒ¨åˆ†çš„ç›¸åŒç›®å½•ä¸­æ˜¯å®ç° IDE è‰¯å¥½è‡ªåŠ¨è¡¥å…¨çš„ç¬¬ä¸€å¤§æ­¥ã€‚

:video-accordion{title="Vue School è§†é¢‘ä»‹ç»æ–°çš„ç›®å½•ç»“æ„" videoId="1031028378" platform="vimeo"}

#### è¿ç§»æ­¥éª¤

1. åˆ›å»ºä¸€ä¸ªåä¸º `app/` çš„æ–°ç›®å½•ã€‚
2. å°†ä½ çš„ `assets/`ã€`components/`ã€`composables/`ã€`layouts/`ã€`middleware/`ã€`pages/`ã€`plugins/` å’Œ `utils/` æ–‡ä»¶å¤¹ç§»åˆ°å…¶ä¸­ï¼Œä»¥åŠ `app.vue`ã€`error.vue`ã€`app.config.ts`ã€‚å¦‚æœä½ å·²æœ‰ `app/router-options.ts` æˆ– `app/spa-loading-template.html`ï¼Œè·¯å¾„ä¿æŒä¸å˜ã€‚
3. ç¡®ä¿ `nuxt.config.ts`ã€`content/`ã€`layers/`ã€`modules/`ã€`public/` å’Œ `server/` æ–‡ä»¶å¤¹ç•™åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆ`app/` å¤–ï¼‰ã€‚
4. è®°å¾—æ›´æ–°ä»»ä½•ç¬¬ä¸‰æ–¹é…ç½®æ–‡ä»¶ä»¥é€‚åº”æ–°çš„ç›®å½•ç»“æ„ï¼Œæ¯”å¦‚ä½ çš„ `tailwindcss` æˆ– `eslint` é…ç½®ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼Œ`@nuxtjs/tailwindcss` ä¼šè‡ªåŠ¨é…ç½®æ­£ç¡®çš„ `tailwindcss`ï¼‰ã€‚

::tip
ä½ å¯ä»¥é€šè¿‡è¿è¡Œ `npx codemod@latest nuxt/4/file-structure` æ¥è‡ªåŠ¨åŒ–æ­¤è¿ç§»ã€‚
::

ç„¶è€Œï¼Œè¿ç§» _éå¿…éœ€_ã€‚å¦‚æœæƒ³ç»§ç»­ä½¿ç”¨å½“å‰çš„æ–‡ä»¶å¤¹ç»“æ„ï¼ŒNuxt ä¼šè‡ªåŠ¨æ£€æµ‹ã€‚å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ï¼Œè¯·æäº¤ issueã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯å¦‚æœä½ å·²ç»è‡ªå®šä¹‰äº† `srcDir`ã€‚æ­¤æ—¶ï¼Œä½ éœ€è¦çŸ¥é“ `modules/`ã€`public/` å’Œ `server/` æ–‡ä»¶å¤¹ä¼šä»ä½ çš„ `rootDir` è§£æï¼Œè€Œä¸æ˜¯ä»è‡ªå®šä¹‰çš„ `srcDir`ã€‚å¦‚æœ‰éœ€è¦ï¼Œä½ å¯é€šè¿‡é…ç½® `dir.modules`ã€`dir.public` å’Œ `serverDir` æ¥è¦†ç›–ã€‚

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å¼ºåˆ¶ä½¿ç”¨ v3 æ–‡ä»¶å¤¹ç»“æ„ï¼š

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  // å°†æ–°çš„ srcDir é»˜è®¤å€¼ä» `app` æ”¹å›æ ¹ç›®å½•
  srcDir: '.',
  // æŒ‡å®š `app/router.options.ts` å’Œ `app/spa-loading-template.html` çš„ç›®å½•å‰ç¼€
  dir: {
    app: 'app',
  },
})
```

### å•ä¾‹æ•°æ®è·å–å±‚

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

#### å˜åŒ–å†…å®¹

Nuxt çš„æ•°æ®è·å–ç³»ç»Ÿ (`useAsyncData` å’Œ `useFetch`) å·²ç»è¢«å¤§å¹…é‡æ„ï¼Œä»¥æå‡æ€§èƒ½å’Œä¸€è‡´æ€§ï¼š

1. **ç›¸åŒ key å…±äº« refs**ï¼šæ‰€æœ‰è°ƒç”¨ `useAsyncData` æˆ– `useFetch` å¹¶ä½¿ç”¨ç›¸åŒ key çš„è°ƒç”¨éƒ½ä¼šå…±äº«åŒä¸€ä»½ `data`ã€`error` å’Œ `status` refsã€‚è¿™æ„å‘³ç€æ‰€æœ‰å¸¦æ˜¾å¼ key çš„è°ƒç”¨çš„é€‰é¡¹ `deep`ã€`transform`ã€`pick`ã€`getCachedData` æˆ– `default` ä¸èƒ½å†²çªã€‚

2. **å¯¹ `getCachedData` æ›´å¤šæ§åˆ¶**ï¼šç°åœ¨æ— è®ºæ•°æ®æ˜¯å¦æ¥è‡ª watcher è¿˜æ˜¯é€šè¿‡è°ƒç”¨ `refreshNuxtData`ï¼Œæ¯æ¬¡è¯·æ±‚æ•°æ®æ—¶éƒ½ä¼šè°ƒç”¨ `getCachedData`ã€‚ä¹‹å‰è¿™äº›åœºæ™¯ä¸‹ä¼šå¼ºåˆ¶é‡æ–°è·å–æ•°æ®è€Œä¸è°ƒç”¨è¯¥å‡½æ•°ã€‚ä¸ºäº†æ›´çµæ´»åœ°æ§åˆ¶ä½•æ—¶ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œå‡½æ•°æ¥æ”¶çš„ä¸Šä¸‹æ–‡å‚æ•°ä¸­åŒ…å«äº†è¯·æ±‚æ¥æºã€‚

3. **æ”¯æŒå“åº”å¼ key**ï¼šç°åœ¨å¯ä½¿ç”¨è®¡ç®—çš„ refsã€æ™®é€š refs æˆ– getter å‡½æ•°ä½œä¸º keyï¼Œä»è€Œæ”¯æŒè‡ªåŠ¨æ•°æ®åˆ·æ–°ï¼ˆå¹¶åˆ†å¼€å­˜å‚¨æ•°æ®ï¼‰ã€‚

4. **æ•°æ®æ¸…ç†**ï¼šå½“æœ€åä¸€ä¸ªä½¿ç”¨äº†æŸæ¡ `useAsyncData` è·å–æ•°æ®çš„ç»„ä»¶å¸è½½æ—¶ï¼ŒNuxt ä¼šç§»é™¤è¿™æ¡æ•°æ®ï¼Œé¿å…å†…å­˜æŒç»­å¢é•¿ã€‚

#### å˜æ›´åŸå› 

è¿™äº›ä¿®æ”¹æ˜¯ä¸ºäº†æ”¹å–„å†…å­˜ä½¿ç”¨æ•ˆç‡å’Œæå‡å¤šä¸ªè°ƒç”¨ä¹‹é—´åŠ è½½çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚

#### è¿ç§»æ­¥éª¤

1. **æ£€æŸ¥ä¸ä¸€è‡´çš„é€‰é¡¹**ï¼šå®¡æŸ¥ä»»ä½•å¯¹ç›¸åŒ key ä½¿ç”¨ä¸ä¸€è‡´é€‰é¡¹æˆ–è·å–å‡½æ•°çš„ç»„ä»¶ã€‚

   ```ts
   // è¿™å°†è§¦å‘è­¦å‘Š
   const { data: users1 } = useAsyncData('users', () => $fetch('/api/users'), { deep: false })
   const { data: users2 } = useAsyncData('users', () => $fetch('/api/users'), { deep: true })
   ```

   å»ºè®®å°†å¯¹åŒä¸€æ˜ç¡® key çš„è°ƒç”¨ï¼ˆåŒæ—¶å«è‡ªå®šä¹‰é€‰é¡¹ï¼‰æå–åˆ°ç‹¬ç«‹çš„ç»„åˆå‡½æ•°ä¸­ï¼š

   ```ts [composables/useUserData.ts]
   export function useUserData (userId: string) {
     return useAsyncData(
       `user-${userId}`,
       () => fetchUser(userId),
       {
         deep: true,
         transform: user => ({ ...user, lastAccessed: new Date() }),
       },
     )
   }
   ```

2. **æ›´æ–° `getCachedData` çš„å®ç°**ï¼š

   ```diff
   useAsyncData('key', fetchFunction, {
   -  getCachedData: (key, nuxtApp) => {
   -    return cachedData[key]
   -  }
   +  getCachedData: (key, nuxtApp, ctx) => {
   +    // ctx.cause - å¯èƒ½æ˜¯ 'initial' | 'refresh:hook' | 'refresh:manual' | 'watch'
   +    
   +    // ä¾‹å­ï¼šæ‰‹åŠ¨åˆ·æ–°æ—¶ä¸ä½¿ç”¨ç¼“å­˜
   +    if (ctx.cause === 'refresh:manual') return undefined
   +    
   +    return cachedData[key]
   +  }
   })
   ```

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å…³é—­è¯¥è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    granularCachedData: false,
    purgeCachedData: false,
  },
})
```

### ä¿®æ­£ Layers ä¸­æ¨¡å—åŠ è½½é¡ºåº

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

ä½¿ç”¨ [Nuxt Layers](/docs/3.x/guide/going-further/layers) æ—¶ï¼Œæ¨¡å—åŠ è½½é¡ºåºè¢«ä¿®æ­£ã€‚ä¹‹å‰é¡¹ç›®æ ¹ç›®å½•çš„æ¨¡å—ä¼šä¼˜å…ˆåŠ è½½ï¼Œå¯¼è‡´é¡ºåºä¸é¢„æœŸç›¸åã€‚

ç°åœ¨æ¨¡å—åŠ è½½é¡ºåºæ­£ç¡®ï¼š

1. **Layer æ¨¡å—å…ˆåŠ è½½**ï¼ˆæŒ‰ç»§æ‰¿é¡ºåºï¼Œè¾ƒæ·±å±‚å…ˆï¼‰
2. **é¡¹ç›®æ¨¡å—ååŠ è½½**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

å½±å“åŒ…æ‹¬ï¼š
* åœ¨ `nuxt.config.ts` çš„ `modules` æ•°ç»„ä¸­å£°æ˜çš„æ¨¡å—
* `modules/` ç›®å½•çš„è‡ªåŠ¨å‘ç°æ¨¡å—

#### å˜æ›´åŸå› 

æ­¤å˜åŒ–ç¡®ä¿ï¼š
* æ‰©å±•å±‚ä¼˜å…ˆçº§ä½äºä½¿ç”¨å®ƒçš„é¡¹ç›®
* æ¨¡å—æ‰§è¡Œé¡ºåºç¬¦åˆç›´è§‚çš„å±‚çº§ç»§æ‰¿æ¨¡å¼
* å¤šå±‚ç»“æ„ä¸­æ¨¡å—é…ç½®å’Œé’©å­æ­£å¸¸å·¥ä½œ

#### è¿ç§»æ­¥éª¤

**å¤§å¤šæ•°é¡¹ç›®æ— éœ€æ›´æ”¹**ï¼Œè¯¥ä¿®æ­£ä½¿åŠ è½½é¡ºåºä¸é¢„æœŸä¸€è‡´ã€‚

ä½†å¦‚æœä½ çš„é¡¹ç›®ä¾èµ–ä¹‹å‰çš„é”™è¯¯é¡ºåºï¼Œå¯èƒ½éœ€è¦ï¼š

1. **æ£€æŸ¥æ¨¡å—ä¾èµ–**ï¼šç¡®è®¤æ¨¡å—åŠ è½½é¡ºåºæ˜¯å¦æœ‰ä¸¥æ ¼ä¾èµ–
2. **è°ƒæ•´æ¨¡å—é…ç½®**ï¼šå¦‚æœæœ‰ä¸ºé€‚åº”æ—§é¡ºåºçš„é…ç½®ï¼Œè¿›è¡Œè°ƒæ•´
3. **å…¨é¢æµ‹è¯•**ï¼šç¡®ä¿åŠŸèƒ½æ­£å¸¸ä¸”é¡ºåºæ­£ç¡®

æ­£ç¡®é¡ºåºç¤ºä¾‹ï¼š

```ts
// Layer: my-layer/nuxt.config.ts
export default defineNuxtConfig({
  modules: ['layer-module-1', 'layer-module-2'],
})

// Project: nuxt.config.ts
export default defineNuxtConfig({
  extends: ['./my-layer'],
  modules: ['project-module-1', 'project-module-2'],
})

// åŠ è½½é¡ºåºï¼ˆå·²ä¿®æ­£ï¼‰ï¼š
// 1. layer-module-1
// 2. layer-module-2
// 3. project-module-1ï¼ˆå¯ä»¥è¦†ç›– layer æ¨¡å—ï¼‰
// 4. project-module-2ï¼ˆå¯ä»¥è¦†ç›– layer æ¨¡å—ï¼‰
```

å¦‚æœå› éœ€æ³¨å†Œé’©å­è€Œé‡åˆ°æ¨¡å—åŠ è½½é¡ºåºé—®é¢˜ï¼Œå¯è€ƒè™‘ä½¿ç”¨ [`modules:done` é’©å­](/docs/3.x/guide/going-further/modules#custom-hooks)ï¼Œè¯¥é’©å­åœ¨æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆåè°ƒç”¨ï¼Œå®‰å…¨ä½¿ç”¨ã€‚

ğŸ‘‰ è¯¦æƒ…è§ [PR #31507](https://github.com/nuxt/nuxt/pull/31507) åŠ [issue #25719](https://github.com/nuxt/nuxt/issues/25719)ã€‚

### è·¯ç”±å…ƒæ•°æ®å»é‡

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

é€šè¿‡ `definePageMeta` è®¾ç½®çš„æŸäº›è·¯ç”±å…ƒæ•°æ®ï¼ˆå¦‚ `name`ã€`path` ç­‰ï¼‰ï¼Œä¹‹å‰æ—¢å­˜åœ¨äº `route` å¯¹è±¡ä¸Šï¼Œä¹Ÿå­˜åœ¨äºè·¯ç”±å…ƒæ•°æ®ä¸­ï¼ˆä¾‹å¦‚ `route.name` ä¸ `route.meta.name`ï¼‰ã€‚

ç°åœ¨å®ƒä»¬ä»…å­˜åœ¨äºè·¯ç”±å¯¹è±¡ä¸Šã€‚

#### å˜æ›´åŸå› 

è¯¥å˜åŒ–æ˜¯å¼€å¯é»˜è®¤ `experimental.scanPageMeta` åçš„æ€§èƒ½ä¼˜åŒ–ã€‚

#### è¿ç§»æ­¥éª¤

è¿ç§»å¾ˆç®€å•ï¼š

```diff
  const route = useRoute()
  
- console.log(route.meta.name)
+ console.log(route.name)
```

### ç»„ä»¶åç§°è§„èŒƒåŒ–

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

Vue ç°åœ¨ä¼šç”Ÿæˆç¬¦åˆ Nuxt ç»„ä»¶å‘½åè§„èŒƒçš„ç»„ä»¶åç§°ã€‚

#### å˜åŒ–å†…å®¹

å¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®ç»„ä»¶åç§°ï¼ŒVue é»˜è®¤å°†ç»„ä»¶åç§°è®¾ä¸ºç»„ä»¶çš„æ–‡ä»¶åã€‚

ä¾‹å¦‚ç›®å½•ç»“æ„ï¼š

```bash [ç›®å½•ç»“æ„]
â”œâ”€ components/
â”œâ”€â”€â”€ SomeFolder/
â”œâ”€â”€â”€â”€â”€ MyComponent.vue
```

Vue ä¸­ï¼Œè¯¥ç»„ä»¶åç§°ä¸º `MyComponent`ã€‚ç”¨äº `<KeepAlive>` æˆ– Vue DevTools æ—¶å³æ˜¯æ­¤åç§°ã€‚

ä½†è‡ªåŠ¨å¯¼å…¥æ—¶éœ€è¦ç”¨ `SomeFolderMyComponent`ã€‚

ç°åœ¨è¿™ä¸¤ä¸ªåç§°å°†ç»Ÿä¸€ï¼ŒVue ä¼šç”ŸæˆåŒ¹é… Nuxt ç»„ä»¶å‘½åè§„èŒƒçš„åç§°ã€‚

#### è¿ç§»æ­¥éª¤

è¯·ç¡®ä¿æ‰€æœ‰ä¾èµ–ç»„ä»¶åç§°çš„æµ‹è¯•ï¼ˆå¦‚ä½¿ç”¨ `@vue/test-utils` çš„ `findComponent`ï¼‰å’Œ `<KeepAlive>` æ ‡ç­¾ä½¿ç”¨æ›´æ–°åçš„åç§°ã€‚

ä½ ä¹Ÿå¯ä»¥æš‚æ—¶é€šè¿‡ä»¥ä¸‹é…ç½®å…³é—­è¯¥è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    normalizeComponentNames: false,
  },
})
```

### Unhead v2

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

ç”Ÿæˆ `<head>` æ ‡ç­¾çš„ [Unhead](https://unhead.unjs.io/) æ›´æ–°è‡³ç‰ˆæœ¬ 2ã€‚å¤§å¤šæ•°å…¼å®¹ï¼Œä½†åº•å±‚ API æœ‰è‹¥å¹²ç ´åæ€§å˜æ›´ï¼š

* ç§»é™¤äº†å±æ€§ï¼š`vmid`ã€`hid`ã€`children`ã€`body`ã€‚
* ä¸å†æ”¯æŒ Promise ç±»å‹è¾“å…¥ã€‚
* æ ‡ç­¾æ’åºé»˜è®¤ä½¿ç”¨ Capo.jsã€‚

#### è¿ç§»æ­¥éª¤

ä¸Šè¿°å˜æ›´å¯¹åº”ç”¨å½±å“è¾ƒå°ã€‚

ç¡®ä¿æœªä½¿ç”¨å·²ç§»é™¤å±æ€§ï¼š

```diff
useHead({
  meta: [{ 
    name: 'description', 
    // meta æ ‡ç­¾ä¸å†éœ€è¦ vmid æˆ– key    
-   vmid: 'description' 
-   hid: 'description'
  }]
})
```

å¦‚æœä½¿ç”¨äº† [æ¨¡æ¿å‚æ•°](https://unhead.unjs.io/docs/head/guides/plugins/template-params) æˆ– [åˆ«åæ’åº](https://unhead.unjs.io/docs/head/guides/plugins/alias-sorting)ï¼Œéœ€æ˜¾å¼å¯ç”¨ï¼š

```ts
import { AliasSortingPlugin, TemplateParamsPlugin } from '@unhead/vue/plugins'

export default defineNuxtPlugin({
  setup () {
    const unhead = injectHead()
    unhead.use(TemplateParamsPlugin)
    unhead.use(AliasSortingPlugin)
  },
})
```

è™½ç„¶ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å»ºè®®å°†ä»»ä½•ä» `@unhead/vue` çš„å¯¼å…¥æ›´æ–°ä¸º `#imports` æˆ– `nuxt/app`ã€‚

```diff
-import { useHead } from '@unhead/vue'
+import { useHead } from '#imports'
```

è‹¥ä»æœ‰é—®é¢˜ï¼Œå¯é€šè¿‡å¼€å¯æ—§ç‰ˆæ¨¡å¼æ¢å¤ v1 è¡Œä¸ºï¼š

```ts
export default defineNuxtConfig({
  unhead: {
    legacy: true,
  },
})
```

### SPA åŠ è½½å±å¹•çš„æ–° DOM ä½ç½®

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ï¼ˆ`ssr: false`ï¼‰æ—¶ï¼ŒNuxt åŠ è½½å±å¹•ï¼ˆå–è‡ª `app/spa-loading-template.html`ï¼‰é»˜è®¤æ¸²æŸ“ä½ç½®ç”±ï¼š

```html
<div id="__nuxt">
  <!-- spa loading template -->
</div>
```

å˜æ›´ä¸ºï¼š

```html
<div id="__nuxt"></div>
<!-- spa loading template -->
```

åŠ è½½æ¨¡æ¿ä¸å†åŒ…è£¹åœ¨ `#_nuxt` å†…ä¾§ã€‚

#### å˜æ›´åŸå› 

æ­¤ä¸¾ç¡®ä¿åŠ è½½æ¨¡æ¿ä¿ç•™åœ¨ DOM ä¸­ç›´åˆ° Vue Suspense è§£æå®Œæˆï¼Œé˜²æ­¢ç™½å±é—ªçƒã€‚

#### è¿ç§»æ­¥éª¤

è‹¥æœ‰ä½¿ç”¨ CSS æˆ– `document.querySelector` é’ˆå¯¹åŠ è½½æ¨¡æ¿ï¼Œéœ€æ›´æ–°é€‰æ‹©å™¨ã€‚å¯ç”¨æ–°é…ç½® `app.spaLoaderTag` å’Œ `app.spaLoaderAttrs` ååŠ©ã€‚

è‹¥éœ€æ¢å¤æ—§è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    spaLoadingTemplateLocation: 'within',
  },
})
```

### è§£æ `error.data`

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

ä¹‹å‰æŠ›å‡ºçš„é”™è¯¯å¯¹è±¡ä¸­çš„ `data` æœªè¢«è§£æã€‚ç°åœ¨è¯¥å­—æ®µè¢«è§£æåå¯ç›´æ¥ä½¿ç”¨ã€‚è™½ç„¶æ˜¯ä¿®æ­£ï¼Œä½†å¯¹ä¾èµ–æ—§è¡Œä¸ºè‡ªè¡Œè§£ææ•°æ®çš„ç”¨æˆ·å±äºç ´åæ€§å˜æ›´ã€‚

#### è¿ç§»æ­¥éª¤

æ›´æ–°è‡ªå®šä¹‰çš„ `error.vue`ï¼Œç§»é™¤å¯¹ `error.data` çš„é¢å¤–è§£æï¼š

```diff
  <script setup lang="ts">
  import type { NuxtError } from '#app'

  const props = defineProps({
    error: Object as () => NuxtError
  })

- const data = JSON.parse(error.data)
+ const data = error.data
  </script>
```

ä½ ä¹Ÿå¯å…³é—­è¯¥å®éªŒç‰¹æ€§ï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    parseErrorData: false,
  },
})
```

### æ›´ç²¾ç»†çš„å†…è”æ ·å¼

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

#### å˜åŒ–å†…å®¹

Nuxt ä»…å¯¹ Vue ç»„ä»¶å†…è”æ ·å¼ï¼Œè€Œéæ‰€æœ‰å…¨å±€ CSSã€‚

ä¹‹å‰ Nuxt ä¼šå°†æ‰€æœ‰ CSSï¼ˆå«å…¨å±€æ ·å¼ï¼‰å†…è”å¹¶ç§»é™¤ `<link>` æ ‡ç­¾ï¼›ç°åœ¨åªå†…è” Vue ç»„ä»¶çš„ CSSï¼ˆè¿™äº›ç»„ä»¶ä¹‹å‰ä¼šæ‹†åˆ†æˆç‹¬ç«‹ CSS chunkï¼‰ã€‚è¿™é¿å…é¦–å±è¯·æ±‚ç‹¬ç«‹ `.css` æ–‡ä»¶ï¼Œæ”¯æŒç¼“å­˜å•ä¸€å…¨å±€ CSSï¼Œå‡å°‘åˆå§‹æ–‡æ¡£å¤§å°ã€‚

#### è¿ç§»æ­¥éª¤

ä½ å¯ä»¥é€šè¿‡å¯ç”¨æ—§è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  features: {
    inlineStyles: true,
  },
})
```

### å»¶åæ‰«æé¡µé¢å…ƒæ•°æ®

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

æ‰«æé¡µé¢å…ƒæ•°æ®ï¼ˆ`definePageMeta`ï¼‰çš„æ—¶æœºæ”¹ä¸ºåœ¨ `pages:extend` é’©å­ä¹‹åï¼Œè€Œéä¹‹å‰ã€‚

#### å˜æ›´åŸå› 

èƒ½æ‰«æ `pages:extend` ä¸­æ–°å¢çš„é¡µé¢å…ƒæ•°æ®ã€‚æ–°å¢é’©å­ `pages:resolved` ç”¨äºä¿®æ”¹æˆ–è¦†ç›–å…ƒæ•°æ®ã€‚

#### è¿ç§»æ­¥éª¤

å¦‚éœ€è¦†ç›–é¡µé¢å…ƒæ•°æ®ï¼Œåº”åœ¨ `pages:resolved` é’©å­ä¸­è¿›è¡Œï¼š

```diff
  export default defineNuxtConfig({
    hooks: {
-     'pages:extend'(pages) {
+     'pages:resolved'(pages) {
        const myPage = pages.find(page => page.path === '/')
        myPage.meta ||= {}
        myPage.meta.layout = 'overridden-layout'
      }
    }
  })
```

ä½ ä¹Ÿå¯é€šè¿‡é…ç½®æ¢å¤æ—§è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    scanPageMeta: true,
  },
})
```

### å…±äº«é¢„æ¸²æŸ“æ•°æ®

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

#### å˜åŒ–å†…å®¹

å¯ç”¨äº†ä¹‹å‰çš„å®éªŒç‰¹æ€§ï¼Œæ”¯æŒåœ¨ä¸åŒé¡µé¢é—´å…±äº« `useAsyncData` å’Œ `useFetch` è°ƒç”¨çš„æ•°æ®ã€‚è¯¦æƒ…è§ [ç›¸å…³ PR](https://github.com/nuxt/nuxt/pull/24894)ã€‚

#### å˜æ›´åŸå› 

è¯¥åŠŸèƒ½å…è®¸é¢„æ¸²æŸ“æ—¶åœ¨é¡µé¢é—´å…±äº«æ•°æ®è½½è·ï¼Œæ˜¾è‘—æå‡å¤šé¡µé¢è¯·æ±‚åŒä¸€æ•°æ®ï¼ˆå¦‚å¯¼èˆªæ æ•°æ®ï¼‰çš„æ€§èƒ½ã€‚

#### è¿ç§»æ­¥éª¤

ç¡®ä¿æ‰€æœ‰æ•°æ® key å”¯ä¸€æ˜ å°„å¯¹åº”æ•°æ®ã€‚ä¾‹å¦‚åŠ¨æ€é¡µé¢ä¸­ï¼Œ`useAsyncData` çš„ key åº”å”¯ä¸€æ ‡è¯†è¯·æ±‚èµ„æºï¼š

```ts [app/pages/test/[slug\\].vue]
// è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸º slug å½±å“æ•°æ®ä½† key æ— å˜åŒ–
const route = useRoute()
const { data } = await useAsyncData(async () => {
  return await $fetch(`/api/my-page/${route.params.slug}`)
})
// åº”ç¡®ä¿ key å”¯ä¸€æ ‡è¯†æ•°æ®
const { data } = await useAsyncData(route.params.slug, async () => {
  return await $fetch(`/api/my-page/${route.params.slug}`)
})
```

ä½ å¯é€šè¿‡é…ç½®å…³é—­è¯¥åŠŸèƒ½ï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    sharedPrerenderData: false,
  },
})
```

### `useAsyncData` å’Œ `useFetch` ä¸­é»˜è®¤çš„ `data` å’Œ `error` å€¼

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

`useAsyncData` è¿”å›çš„ `data` å’Œ `error` é»˜è®¤å€¼ç°åœ¨ä¸º `undefined`ï¼ˆæ­¤å‰åˆ†åˆ«ä¸º `null` å’Œ `null`/`undefined`ï¼‰ã€‚

#### å˜æ›´åŸå› 

ä¿è¯åˆå§‹åŒ–ä¸€è‡´æ€§ã€‚

#### è¿ç§»æ­¥éª¤

å¦‚æœä»£ç ä¸­æ£€æŸ¥ `null`ï¼Œè¯·æ”¹ä¸ºæ£€æŸ¥ `undefined`ï¼Œä¾‹å¦‚ï¼š

```ts
if (data.value === undefined) { ... }
```

::tip
å¯ç”¨å‘½ä»¤è‡ªåŠ¨è¿ç§» `npx codemod@latest nuxt/4/default-data-error-value`ã€‚
::

è‹¥é‡é—®é¢˜å¯å…³é—­æ­¤å˜æ›´ï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    defaults: {
      useAsyncData: {
        value: 'null',
        errorValue: 'null',
      },
    },
  },
})
```

å¦‚æœæ‚¨æ­£åœ¨è¿™æ ·åšï¼Œè¯·æŠ¥å‘Šé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—å°†å…¶ä¿æŒä¸ºå¯é…ç½®é¡¹ã€‚

### ç§»é™¤åœ¨ `useAsyncData` å’Œ `useFetch` ä¸­è°ƒç”¨ `refresh` æ—¶ï¼Œ`dedupe` é€‰é¡¹å·²å¼ƒç”¨çš„ `boolean` å€¼

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€ä½

#### å˜æ›´å†…å®¹

ä¹‹å‰å¯ä»¥ä¼ é€’ `dedupe: boolean` ç»™ `refresh`ã€‚è¿™äº›æ˜¯ `cancel`ï¼ˆ`true`ï¼‰å’Œ `defer`ï¼ˆ`false`ï¼‰çš„åˆ«åã€‚

```ts twoslash [app.vue]
// @errors: 2322
const { refresh } = await useAsyncData(() => Promise.resolve({ message: 'Hello, Nuxt!' }))

async function refreshData () {
  await refresh({ dedupe: true })
}
```

#### å˜æ›´åŸå› 

ä¸ºäº†æ›´æ¸…æ™°ï¼Œè¿™äº›åˆ«åå·²è¢«ç§»é™¤ã€‚

åœ¨ä¸º `useAsyncData` æ·»åŠ  `dedupe` é€‰é¡¹æ—¶å‡ºç°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç§»é™¤äº†å¸ƒå°”å€¼ï¼Œå› ä¸ºå®ƒä»¬æœ€ç»ˆå˜æˆäº†_ç›¸å_çš„æ„æ€ã€‚

`refresh({ dedupe: false })` çš„æ„æ€æ˜¯**ä¸è¦ä¸ºäº†è¿™ä¸ªæ–°è¯·æ±‚è€Œå–æ¶ˆå·²æœ‰çš„è¯·æ±‚**ã€‚ä½†åœ¨ `useAsyncData` çš„é€‰é¡¹ä¸­ä¼ é€’ `dedupe: true` åˆ™è¡¨ç¤º**å¦‚æœå·²æœ‰æŒ‚èµ·çš„è¯·æ±‚ï¼Œåˆ™ä¸å†å‘èµ·æ–°çš„è¯·æ±‚ã€‚**ï¼ˆå‚è§ [PR](https://github.com/nuxt/nuxt/pull/24564#pullrequestreview-1764584361)ã€‚ï¼‰

#### è¿ç§»æ­¥éª¤

è¿ç§»åº”è¯¥å¾ˆç®€å•ï¼š

```diff
  const { refresh } = await useAsyncData(async () => ({ message: 'Hello, Nuxt!' }))

  async function refreshData () {
-   await refresh({ dedupe: true })
+   await refresh({ dedupe: 'cancel' })

-   await refresh({ dedupe: false })
+   await refresh({ dedupe: 'defer' })
  }
```

::tip
è‡ªåŠ¨è¿ç§»ï¼š`npx codemod@latest nuxt/4/deprecated-dedupe-value`ã€‚
::

### `useAsyncData` å’Œ `useFetch` æ¸…ç†æ•°æ®æ—¶éµå®ˆé»˜è®¤å€¼

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

è°ƒç”¨ `clear` æˆ– `clearNuxtData` æ—¶ï¼Œè‹¥è®¾ç½®äº† `default` å€¼ï¼Œåˆ™ç”¨é»˜è®¤å€¼é‡ç½®æ•°æ®ï¼Œè€Œéç›´æ¥æ¸…ç©ºã€‚

#### å˜æ›´åŸå› 

å°Šé‡ç”¨æˆ·è‡ªå®šä¹‰é»˜è®¤ç©ºå€¼ï¼Œé¿å…é¢‘ç¹æ£€æŸ¥ `null` æˆ– `undefined`ã€‚

#### è¿ç§»æ­¥éª¤

é‡é—®é¢˜å¯æš‚ç”¨é…ç½®å…³é—­è¯¥è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    resetAsyncDataToUndefined: true,
  },
})
```

æœªæ¥è¯¥é…ç½®å¯èƒ½ç§»é™¤ã€‚

### `useAsyncData` å’Œ `useFetch` ä¸­ `pending` å€¼å¯¹é½

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

`useAsyncData`ã€`useFetch`ã€`useLazyAsyncData` å’Œ `useLazyFetch` è¿”å›çš„ `pending` ç°åœ¨ä¸ºè®¡ç®—å±æ€§ï¼Œä¸”ä»…åœ¨ `status` ä¸º `pending` æ—¶è¿”å› `true`ã€‚

#### å˜åŒ–å†…å®¹

å½“è®¾ç½® `immediate: false` æ—¶ï¼Œ`pending` åœ¨é¦–æ¬¡è¯·æ±‚å‘èµ·å‰ä¿æŒ `false`ï¼ˆä¹‹å‰å§‹ç»ˆä¸º `true`ï¼‰ã€‚

#### å˜æ›´åŸå› 

ä¿è¯ `pending` å’Œ `status` ä¸€è‡´ï¼Œå‡è¡¨ç¤ºè¯·æ±‚ä¸­çŠ¶æ€ã€‚

#### è¿ç§»æ­¥éª¤

ä¾èµ– `pending` çš„é€»è¾‘éœ€éµå¾ªæ–°è¯­ä¹‰ï¼Œç¤ºä¾‹ï¼š

```diff
  <template>
-   <div v-if="!pending">
+   <div v-if="status === 'success'">
      <p>Data: {{ data }}</p>
    </div>
    <div v-else>
      <p>Loading...</p>
    </div>
  </template>
  <script setup lang="ts">
  const { data, pending, execute, status } = await useAsyncData(() => fetch('/api/data'), {
    immediate: false
  })
  onMounted(() => execute())
  </script>
```

å¯ç”¨é…ç½®ä¸´æ—¶æ¢å¤æ—§è¡Œä¸ºï¼š

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    pendingWhenIdle: true,
  },
})
```

### `useAsyncData` å’Œ `useFetch` ä¸­ key å˜æ›´è¡Œä¸º

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

#### å˜åŒ–å†…å®¹

å“åº”å¼ key å˜åŒ–æ—¶ï¼Œ`useAsyncData` ä»…åœ¨å·²æœ‰æ•°æ®æ—¶é‡æ–°è¯·æ±‚æ•°æ®ï¼Œç¬¦åˆ `immediate: false` è¯­ä¹‰ã€‚`useFetch` è¡Œä¸ºç°åœ¨ä¸ä¹‹ä¿æŒä¸€è‡´ï¼Œå‡ä¸ä¼šæ— æ¡ä»¶è¯·æ±‚ã€‚

#### å˜æ›´åŸå› 

ç»Ÿä¸€è¡Œä¸ºé˜²æ­¢æ„å¤–è¯·æ±‚ã€‚å…³é—­è‡ªåŠ¨è¯·æ±‚æ—¶ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ `refresh` æˆ– `execute`ã€‚

#### è¿ç§»æ­¥éª¤

å¦‚ä¾èµ–æ—§è¡Œä¸ºè‡ªåŠ¨è¯·æ±‚ï¼Œå¯æ‰‹åŠ¨æ³¨å†Œç›‘å¬ï¼š

```diff
  const id = ref('123')
  const { data, execute } = await useFetch('/api/test', {
    query: { id },
    immediate: false
  })
+ watch(id, () => execute(), { once: true })
```

å¯å…¨å±€ç¦ç”¨è¯¥è¡Œä¸ºï¼š

```ts
// æˆ–äº Nuxt é…ç½®
export default defineNuxtConfig({
  experimental: {
    alwaysRunFetchOnKeyChange: true,
  },
})
```

### `useAsyncData` å’Œ `useFetch` ä¸­çš„æ•°æ®æµ…å±‚å“åº”æ€§

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

`useAsyncData`ã€`useFetch`ã€`useLazyAsyncData` åŠ `useLazyFetch` è¿”å›çš„ `data` ç”± `ref` å˜ä¸º `shallowRef`ã€‚

#### å˜åŒ–å†…å®¹

æ–°æ•°æ®åˆ°è¾¾æ—¶æ›¿æ¢ `data` å¯¹è±¡è§¦å‘å“åº”ï¼›ä¿®æ”¹å†…éƒ¨å±æ€§ä¸å†è§¦å‘å“åº”ã€‚

#### å˜æ›´åŸå› 

æå¤§æå‡æ·±å±‚åµŒå¥—å¯¹è±¡æ€§èƒ½ï¼Œé¿å…ç›‘å¬æ¯ä¸ªå±æ€§ã€‚å¤šæ•°åœºæ™¯æ•°æ®åº”ä¿æŒä¸å˜ã€‚

#### è¿ç§»æ­¥éª¤

ä¸€èˆ¬æ— éœ€å˜æ›´ã€‚è‹¥ä¾èµ–æ·±å±‚å“åº”æ€§ï¼š

1. é’ˆå¯¹å•ä¸ªç»„åˆå‡½æ•°å¯ç”¨æ·±å±‚å“åº”ï¼š

   ```diff
   - const { data } = useFetch('/api/test')
   + const { data } = useFetch('/api/test', { deep: true })
   ```
2. å…¨å±€é»˜è®¤å¼€å¯ï¼ˆä¸æ¨èï¼‰ï¼š

   ```ts twoslash [nuxt.config.ts]
   export default defineNuxtConfig({
     experimental: {
       defaults: {
         useAsyncData: {
           deep: true,
         },
       },
     },
   })
   ```

::tip
è‡ªåŠ¨è¿ç§»å‘½ä»¤ï¼š`npx codemod@latest nuxt/4/shallow-function-reactivity`
::

### `builder:watch` ä¸­çš„ç»å¯¹è·¯å¾„ç›‘å¬

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

`builder:watch` é’©å­å›è°ƒçš„è·¯å¾„ç°ä¸ºç»å¯¹è·¯å¾„ï¼ˆéç›¸å¯¹äº `srcDir` çš„ç›¸å¯¹è·¯å¾„ï¼‰ã€‚

#### å˜æ›´åŸå› 

æ”¯æŒç›‘å¬ `srcDir` ä»¥å¤–è·¯å¾„ï¼Œæ›´å¥½æ”¯æŒå¤šå±‚å’Œå¤æ‚åœºæ™¯ã€‚

#### è¿ç§»æ­¥éª¤

æˆ‘ä»¬å·²è‡ªåŠ¨è¿ç§»å…¬å…± Nuxt æ¨¡å—ï¼Œ[è¯¦æƒ…è§ issue #25339](https://github.com/nuxt/nuxt/issues/25339)ã€‚

ä½œä¸ºæ¨¡å—ä½œè€…ï¼Œå…¼å®¹å†™æ³•ç¤ºä¾‹ï¼š

```diff
+ import { relative, resolve } from 'node:fs'
  // ...
  nuxt.hook('builder:watch', async (event, path) => {
+   path = relative(nuxt.options.srcDir, resolve(nuxt.options.srcDir, path))
    // ...
  })
```

::tip
è‡ªåŠ¨è¿ç§»å‘½ä»¤ï¼š`npx codemod@latest nuxt/4/absolute-watch-path`
::

### ç§»é™¤ `window.__NUXT__` å¯¹è±¡

#### å˜åŒ–å†…å®¹

åº”ç”¨å®Œæˆ hydration åå…¨å±€å¯¹è±¡ `window.__NUXT__` è¢«ç§»é™¤ã€‚

#### å˜æ›´åŸå› 

ä¸ºå¤šåº”ç”¨æ¨¡å¼é“ºè·¯ï¼ˆ[#21635](https://github.com/nuxt/nuxt/issues/21635)ï¼‰ï¼Œå¹¶ç»Ÿä¸€é€šè¿‡ `useNuxtApp()` è®¿é—® Nuxt æ•°æ®ã€‚

#### è¿ç§»æ­¥éª¤

æ•°æ®ä»å¯è®¿é—®ï¼Œæ”¹ä¸ºï¼š

```diff
- console.log(window.__NUXT__)
+ console.log(useNuxtApp().payload)
```

### ç›®å½•ç´¢å¼•æ‰«ææ”¹è¿›

ğŸš¦ **å½±å“ç­‰çº§**ï¼šä¸­ç­‰

#### å˜åŒ–å†…å®¹

`middleware/` ç›®å½•ä¸‹å­æ–‡ä»¶å¤¹ä¸­çš„ `index` æ–‡ä»¶åŒæ ·ä¼šè¢«æ‰«æå¹¶æ³¨å†Œä¸ºä¸­é—´ä»¶ã€‚

#### å˜æ›´åŸå› 

ä¸ `plugins/` ç›®å½•ä¸€è‡´ï¼Œæ”¯æŒå­æ–‡ä»¶å¤¹ä¸­çš„ index æ–‡ä»¶ã€‚

#### è¿ç§»æ­¥éª¤

é€šå¸¸æ— é¡»è¿ç§»ã€‚å¦‚æƒ³æ¢å¤æ—§è¡Œä¸ºï¼Œå¯åœ¨é’©å­ä¸­è¿‡æ»¤æ‰ `index` ä¸­é—´ä»¶ï¼š

```ts
export default defineNuxtConfig({
  hooks: {
    'app:resolve' (app) {
      app.middleware = app.middleware.filter(mw => !/\/index\.[^/]+$/.test(mw.path))
    },
  },
})
```

### æ¨¡æ¿ç¼–è¯‘å˜æ›´

ğŸš¦ **å½±å“ç­‰çº§**ï¼šæœ€ä½

#### å˜åŒ–å†…å®¹

ä»¥å‰ Nuxt ç”¨ `lodash/template` ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿæ¨¡æ¿ï¼ˆ`.ejs` è¯­æ³•ï¼‰ï¼Œå¹¶æä¾›äº†ä¸€äº›æ¨¡æ¿å·¥å…·å‡½æ•°ï¼ˆå¦‚ `serialize`ã€`importName`ã€`importSources`ï¼‰ï¼Œç°åœ¨ç§»é™¤è¿™äº›ã€‚

#### å˜æ›´åŸå› 

Nuxt v3 å¼•å…¥äº†æ”¯æŒ `getContents()` çš„è™šæ‹Ÿè¯­æ³•ï¼Œæ›´çµæ´»é«˜æ•ˆã€‚`lodash/template` å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œä¸”ä¾èµ–è¾ƒå¤§ã€‚å†…ç½®ä½¿ç”¨ä»£ç åºåˆ—åŒ–ä¸ç†æƒ³ï¼Œæ¨èä½¿ç”¨ [unjs/knitwork](http://github.com/unjs/knitwork)ã€‚

#### è¿ç§»æ­¥éª¤

æˆ‘ä»¬å·²æäº¤ PR ä¿®æ­£ä½¿ç”¨ EJS è¯­æ³•çš„æ¨¡å—ï¼Œä¹Ÿæä¾›ä»¥ä¸‹æ–¹æ¡ˆï¼š

* æŠŠå­—ç¬¦ä¸²æ’å€¼é€»è¾‘è½¬åˆ° `getContents()`ã€‚
* ä½¿ç”¨ç±»ä¼¼ https://github.com/nuxt-modules/color-mode/pull/240 çš„æ›¿æ¢å‡½æ•°ã€‚
* ä½¿ç”¨ `es-toolkit/compat`ï¼ˆlodash template æ›¿ä»£ï¼‰ä½œä¸ºé¡¹ç›®ä¾èµ–ï¼š

```diff
+ import { readFileSync } from 'node:fs'
+ import { template } from 'es-toolkit/compat'
  // ...
  addTemplate({
    fileName: 'appinsights-vue.js'
    options: { /* some options */ },
-   src: resolver.resolve('./runtime/plugin.ejs'),
+   getContents({ options }) {
+     const contents = readFileSync(resolver.resolve('./runtime/plugin.ejs'), 'utf-8')
+     return template(contents)({ options })
+   },
  })
```

å¦‚ä½¿ç”¨ `serialize`ã€`importName`ã€`importSources` å‡½æ•°ï¼Œå¯æ”¹ç”¨ `knitwork`ï¼š

```ts
import { genDynamicImport, genImport, genSafeVariableName } from 'knitwork'

const serialize = (data: any) => JSON.stringify(data, null, 2).replace(/"\{(.+)\}"(?=,?$)/gm, r => JSON.parse(r).replace(/^\{(.*)\}$/, '$1'))

const importSources = (sources: string | string[], { lazy = false } = {}) => {
  return toArray(sources).map((src) => {
    if (lazy) {
      return `const ${genSafeVariableName(src)} = ${genDynamicImport(src, { comment: \`webpackChunkName: \${JSON.stringify(src)}\` })}`
    }
    return genImport(src, genSafeVariableName(src))
  }).join('\n')
}

const importName = genSafeVariableName
```

::tip
è‡ªåŠ¨è¿ç§»å‘½ä»¤ï¼š`npx codemod@latest nuxt/4/template-compilation-changes`
::

### é»˜è®¤ TypeScript é…ç½®æ›´æ”¹

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### æ›´æ”¹å†…å®¹

`compilerOptions.noUncheckedIndexedAccess` ç°åœ¨é»˜è®¤ä¸º `true`ï¼Œè€Œä¸æ˜¯ `false`ã€‚

#### æ›´æ”¹åŸå› 

æ­¤æ›´æ”¹æ˜¯å¯¹ä¹‹å‰ [3.12 é…ç½®æ›´æ–°](https://github.com/nuxt/nuxt/pull/27485) çš„åç»­æ”¹è¿›ï¼Œæˆ‘ä»¬ä¼˜åŒ–äº†é»˜è®¤å€¼ï¼Œä¸»è¦éµå¾ªäº† [TotalTypeScript çš„å»ºè®®](https://www.totaltypescript.com/tsconfig-cheat-sheet)ã€‚

#### è¿ç§»æ­¥éª¤

æœ‰ä¸¤ç§æ–¹æ³•ï¼š

1. å¯¹ä½ çš„åº”ç”¨è¿›è¡Œç±»å‹æ£€æŸ¥å¹¶ä¿®å¤æ‰€æœ‰æ–°å‡ºç°çš„é”™è¯¯ï¼ˆæ¨èï¼‰ã€‚

2. åœ¨ä½ çš„ `nuxt.config.ts` ä¸­è¦†ç›–æ–°çš„é»˜è®¤å€¼ï¼š

   <!-- @case-police-ignore tsConfig -->

   ```ts
   export default defineNuxtConfig({
     typescript: {
       tsConfig: {
         compilerOptions: {
           noUncheckedIndexedAccess: false,
         },
       },
     },
   })
   ```

### TypeScript é…ç½®æ‹†åˆ†

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### å˜æ›´å†…å®¹

Nuxt ç°åœ¨ä¸ºä¸åŒçš„ä¸Šä¸‹æ–‡ç”Ÿæˆå•ç‹¬çš„ TypeScript é…ç½®ï¼Œä»¥æä¾›æ›´å¥½çš„ç±»å‹æ£€æŸ¥ä½“éªŒï¼š

1. **æ–°çš„ TypeScript é…ç½®æ–‡ä»¶**ï¼šNuxt ç°åœ¨ä¼šç”Ÿæˆé¢å¤–çš„ TypeScript é…ç½®ï¼š
   * `.nuxt/tsconfig.app.json` - å¯¹äºæ‚¨çš„åº”ç”¨ä»£ç ï¼ˆVue ç»„ä»¶ã€å¯ç»„åˆé¡¹ç­‰ï¼‰
   * `.nuxt/tsconfig.server.json` - å¯¹äºæ‚¨çš„æœåŠ¡å™¨ç«¯ä»£ç ï¼ˆNitro/server ç›®å½•ï¼‰  
   * `.nuxt/tsconfig.node.json` - å¯¹äºæ‚¨çš„æ„å»ºæ—¶ä»£ç ï¼ˆæ¨¡å—ï¼Œ`nuxt.config.ts` ç­‰ï¼‰
   * `.nuxt/tsconfig.shared.json` - å¯¹äºåº”ç”¨å’ŒæœåŠ¡å™¨ä¸Šä¸‹æ–‡ä¹‹é—´å…±äº«çš„ä»£ç ï¼ˆå¦‚ç±»å‹å’Œéç¯å¢ƒç‰¹å®šçš„å®ç”¨ç¨‹åºï¼‰
   * `.nuxt/tsconfig.json` - æ—§ç‰ˆé…ç½®ï¼Œä¿æŒå‘åå…¼å®¹
2. **å‘åå…¼å®¹æ€§**ï¼šç°æœ‰æ‰©å±• `.nuxt/tsconfig.json` çš„é¡¹ç›®å°†ç»§ç»­åƒä»¥å‰ä¸€æ ·å·¥ä½œã€‚

3. **å¯é€‰æ‹©åŠ å…¥çš„é¡¹ç›®å¼•ç”¨**ï¼šæ–°é¡¹ç›®æˆ–å¸Œæœ›è·å¾—æ›´å¥½ç±»å‹æ£€æŸ¥çš„é¡¹ç›®å¯ä»¥é‡‡ç”¨ TypeScript çš„é¡¹ç›®å¼•ç”¨åŠŸèƒ½ã€‚

4. **ç‰¹å®šä¸Šä¸‹æ–‡ç±»å‹æ£€æŸ¥**ï¼šæ¯ä¸ªä¸Šä¸‹æ–‡ç°åœ¨éƒ½å…·æœ‰é€‚åˆå…¶ç‰¹å®šç¯å¢ƒçš„ç¼–è¯‘å™¨é€‰é¡¹å’ŒåŒ…å«/æ’é™¤è®¾ç½®ã€‚

5. **æ–°çš„ `typescript.nodeTsConfig` é€‰é¡¹**ï¼šä½ ç°åœ¨å¯ä»¥è‡ªå®šä¹‰ Node.js æ„å»ºæ—¶ä»£ç çš„ TypeScript é…ç½®ã€‚

#### å˜æ›´åŸå› 
æ­¤æ›´æ”¹å¸¦æ¥äº†ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š

1. **æ›´å¥½çš„ç±»å‹å®‰å…¨**ï¼šæ¯ä¸ªä¸Šä¸‹æ–‡ï¼ˆåº”ç”¨ã€æœåŠ¡å™¨ã€æ„å»ºæ—¶ï¼‰éƒ½èƒ½é€šè¿‡ç‰¹å®šçš„å…¨å±€å˜é‡å’Œ API è¿›è¡Œé€‚å½“çš„ç±»å‹æ£€æŸ¥ã€‚
2. **æå‡ IDE ä½“éªŒ**ï¼šä¸ºä»£ç åº“çš„ä¸åŒéƒ¨åˆ†æä¾›æ›´å¥½çš„æ™ºèƒ½æç¤ºå’Œé”™è¯¯æŠ¥å‘Šã€‚
3. **æ›´æ¸…æ™°çš„åˆ†ç¦»**ï¼šæœåŠ¡å™¨ç«¯ä»£ç ä¸ä¼šé”™è¯¯åœ°å»ºè®®å®¢æˆ·ç«¯ APIï¼Œåä¹‹äº¦ç„¶ã€‚
4. **æ€§èƒ½æå‡**ï¼šTypeScript èƒ½å¤Ÿé€šè¿‡æ­£ç¡®èŒƒå›´çš„é…ç½®æ›´é«˜æ•ˆåœ°æ£€æŸ¥ä»£ç ã€‚

ä¾‹å¦‚ï¼Œè‡ªåŠ¨å¯¼å…¥åœ¨ä½ çš„ `nuxt.config.ts` ä¸­ä¸å¯ç”¨ï¼ˆä½†ä¹‹å‰ TypeScript å¹¶ä¸ä¼šå¯¹æ­¤è¿›è¡Œæ ‡è®°ï¼‰ã€‚è€Œä¸”è™½ç„¶ IDE èƒ½è¯†åˆ«ä½  `server/` ç›®å½•ä¸‹ `tsconfig.json` æ‰€æç¤ºçš„ç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼Œä½†è¿™å¹¶æœªåæ˜ åœ¨ç±»å‹æ£€æŸ¥ä¸­ï¼ˆéœ€è¦å•ç‹¬çš„æ­¥éª¤ï¼‰ã€‚

#### è¿ç§»æ­¥éª¤

**æ— éœ€è¿ç§»**â€”â€”ç°æœ‰é¡¹ç›®å°†ç»§ç»­ç…§å¸¸è¿è¡Œã€‚

ä¸è¿‡ï¼Œä¸ºäº†åˆ©ç”¨æ›´å®Œå–„çš„ç±»å‹æ£€æŸ¥ï¼Œä½ å¯ä»¥é€‰æ‹©é‡‡ç”¨æ–°çš„é¡¹ç›®å¼•ç”¨æ–¹å¼ï¼š

1. **æ›´æ–°ä½ çš„æ ¹ç›®å½• `tsconfig.json`**ï¼Œä»¥ä½¿ç”¨é¡¹ç›®å¼•ç”¨ï¼š

   ```json
   {
     "files": [],
     "references": [
       { "path": "./.nuxt/tsconfig.app.json" },
       { "path": "./.nuxt/tsconfig.server.json" },
       { "path": "./.nuxt/tsconfig.shared.json" },
       { "path": "./.nuxt/tsconfig.node.json" }
     ]
   }
   ```

2. **ç§»é™¤æ‰€æœ‰æ‰‹åŠ¨åˆ›å»ºçš„æœåŠ¡å™¨ç«¯ `tsconfig.json` æ–‡ä»¶**ï¼ˆä¾‹å¦‚ `server/tsconfig.json`ï¼‰ï¼Œè¿™äº›æ–‡ä»¶å¦‚æœæ‰©å±•äº† `.nuxt/tsconfig.server.json`ï¼Œè¯·åˆ é™¤ã€‚

3. **æ›´æ–°ä½ çš„ç±»å‹æ£€æŸ¥è„šæœ¬**ï¼Œä½¿ç”¨æ„å»ºæ ‡å¿—ä»¥æ”¯æŒé¡¹ç›®å¼•ç”¨ï¼š

   ```diff
   - "typecheck": "nuxt prepare && vue-tsc --noEmit"
   + "typecheck": "nuxt prepare && vue-tsc -b --noEmit"
   ```

4. **å°†æ‰€æœ‰ç±»å‹å¢å¼ºç§»åˆ°å…¶é€‚å½“çš„ä¸Šä¸‹æ–‡ä¸­**ï¼š
   * å¦‚æœä½ æ­£åœ¨å¢å¼ºåº”ç”¨ä¸Šä¸‹æ–‡çš„ç±»å‹ï¼Œè¯·å°†æ–‡ä»¶ç§»åŠ¨åˆ° `app/` ç›®å½•ã€‚
   * å¦‚æœä½ æ­£åœ¨å¢å¼ºæœåŠ¡å™¨ä¸Šä¸‹æ–‡çš„ç±»å‹ï¼Œè¯·å°†æ–‡ä»¶ç§»åŠ¨åˆ° `server/` ç›®å½•ã€‚
   * å¦‚æœä½ æ­£åœ¨å¢å¼ºåœ¨åº”ç”¨å’ŒæœåŠ¡å™¨ä¹‹é—´**å…±äº«**çš„ç±»å‹ï¼Œè¯·å°†æ–‡ä»¶ç§»åŠ¨åˆ° `shared/` ç›®å½•ã€‚

    ::warning
    ä» `app/`ã€`server/` æˆ– `shared/` ç›®å½•ä¹‹å¤–å¢å¼ºç±»å‹å°†æ— æ³•ä¸æ–°çš„é¡¹ç›®å¼•ç”¨è®¾ç½®ä¸€èµ·ä½¿ç”¨ã€‚
    ::

5. **æ ¹æ®éœ€è¦é…ç½® Node.js TypeScript é€‰é¡¹**ï¼š
   <!-- @case-police-ignore tsConfig -->

   ```ts
   export default defineNuxtConfig({
     typescript: {
       // Customize app/server TypeScript config
       tsConfig: {
         compilerOptions: {
           strict: true,
         },
       },
       // Customize build-time TypeScript config
       nodeTsConfig: {
         compilerOptions: {
           strict: true,
         },
       },
     },
   })
   ```

6. **æ›´æ–°æ‰€æœ‰è¿è¡Œ TypeScript æ£€æŸ¥çš„ CI/æ„å»ºè„šæœ¬**ï¼Œç¡®ä¿å®ƒä»¬ä½¿ç”¨æ–°çš„é¡¹ç›®å¼•ç”¨æ–¹æ³•ã€‚

æ–°é…ç½®ä¸ºé€‰æ‹©åŠ å…¥çš„é¡¹ç›®æä¾›äº†æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œæ™ºèƒ½æ„ŸçŸ¥ï¼ŒåŒæ—¶å¯¹ç°æœ‰è®¾ç½®ä¿æŒå®Œå…¨çš„å‘åå…¼å®¹æ€§ã€‚

### ç§»é™¤å®éªŒæ€§åŠŸèƒ½

ğŸš¦ **å½±å“çº§åˆ«**ï¼šæœ€å°

#### å˜æ›´å†…å®¹

åœ¨ Nuxt 4 ä¸­ï¼Œå››ä¸ªå®éªŒæ€§åŠŸèƒ½ä¸å†å¯é…ç½®ï¼š

* `experimental.treeshakeClientOnly` å°†ä¸º `true`ï¼ˆè‡ª v3.0 èµ·ä¸ºé»˜è®¤å€¼ï¼‰
* `experimental.configSchema` å°†ä¸º `true`ï¼ˆè‡ª v3.3 èµ·ä¸ºé»˜è®¤å€¼ï¼‰
* `experimental.polyfillVueUseHead` å°†ä¸º `false`ï¼ˆè‡ª v3.4 èµ·ä¸ºé»˜è®¤å€¼ï¼‰
* `experimental.respectNoSSRHeader` å°†ä¸º `false`ï¼ˆè‡ª v3.4 èµ·ä¸ºé»˜è®¤å€¼ï¼‰
* `vite.devBundler` ä¸å†å¯é…ç½®â€”â€”é»˜è®¤å°†ä½¿ç”¨ `vite-node`

#### å˜æ›´åŸå› 

è¿™äº›é€‰é¡¹å·²ç»è¢«è®¾ç½®ä¸ºå½“å‰çš„å€¼æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘ä»¬æ²¡æœ‰ç†ç”±è®¤ä¸ºå®ƒä»¬éœ€è¦ä¿æŒå¯é…ç½®ã€‚

#### è¿ç§»æ­¥éª¤

* `polyfillVueUseHead` is implementable in user-land with [this plugin](https://github.com/nuxt/nuxt/blob/f209158352b09d1986aa320e29ff36353b91c358/packages/nuxt/src/head/runtime/plugins/vueuse-head-polyfill.ts#L10-L11)

* `respectNoSSRHeader`is implementable in user-land with [server middleware](https://github.com/nuxt/nuxt/blob/c660b39447f0d5b8790c0826092638d321cd6821/packages/nuxt/src/core/runtime/nitro/no-ssr.ts#L8-L9)

### ç§»é™¤é¡¶å±‚ `generate` é…ç½®

ğŸš¦ **å½±å“ç¨‹åº¦**ï¼šæœ€å°

#### å˜æ›´å†…å®¹

Nuxt 4 ä¸å†æä¾›é¡¶å±‚çš„ `generate` é…ç½®é€‰é¡¹ã€‚è¿™åŒ…æ‹¬å…¶æ‰€æœ‰å±æ€§ï¼š

* `generate.exclude` - ç”¨äºä»é¢„æ¸²æŸ“ä¸­æ’é™¤è·¯ç”±
* `generate.routes` - ç”¨äºæŒ‡å®šéœ€è¦é¢„æ¸²æŸ“çš„è·¯ç”±

#### æ›´æ”¹åŸå› 

é¡¶å±‚çš„ `generate` é…ç½®æ˜¯ Nuxt 2 çš„é—ç•™è®¾ç½®ã€‚æˆ‘ä»¬å·²ç»æ”¯æŒ `nitro.prerender` ä¸€æ®µæ—¶é—´äº†ï¼Œå¹¶ä¸”å®ƒæ˜¯ Nuxt 3+ ä¸­é…ç½®é¢„æ¸²æŸ“çš„é¦–é€‰æ–¹å¼ã€‚

#### è¿ç§»æ­¥éª¤

å°† `generate` é…ç½®æ›¿æ¢ä¸ºç›¸åº”çš„ `nitro.prerender` é€‰é¡¹ï¼š

```diff
export default defineNuxtConfig({
- generate: {
-   exclude: ['/admin', '/private'],
-   routes: ['/sitemap.xml', '/robots.txt']
- }
+ nitro: {
+   prerender: {
+     ignore: ['/admin', '/private'],
+     routes: ['/sitemap.xml', '/robots.txt']
+   }
+ }
})
```

::read-more{to="https://nitro.build/config#prerender"}
é˜…è¯»æœ‰å…³ Nitro é¢„æ¸²æŸ“é…ç½®é€‰é¡¹çš„æ›´å¤šä¿¡æ¯ã€‚
::

## Nuxt 2 ä¸ Nuxt 3+

åœ¨ä¸‹è¡¨ä¸­ï¼Œå¯¹ Nuxt çš„ä¸‰ä¸ªç‰ˆæœ¬è¿›è¡Œäº†å¿«é€Ÿæ¯”è¾ƒï¼š

Feature / Version        | Nuxt 2          | Nuxt Bridge      | Nuxt 3+
-------------------------|-----------------|------------------|---------
Vue                      | 2               | 2                | 3
Stability                | ğŸ˜Š Stable      | ğŸ˜Š Stable         | ğŸ˜Š Stable
Performance              | ğŸ Fast        | âœˆï¸ Faster          | ğŸš€ Fastest
Nitro Engine             | âŒ             | âœ…                | âœ…
ESM support              | ğŸŒ™ Partial     | ğŸ‘ Better         | âœ…
TypeScript               | â˜‘ï¸ Opt-in       | ğŸš§ Partial        | âœ…
Composition API          | âŒ             | ğŸš§ Partial        | âœ…
Options API              | âœ…             | âœ…                | âœ…
Components Auto Import   | âœ…             | âœ…                | âœ…
`<script setup>` syntax  | âŒ             | ğŸš§ Partial        | âœ…
Auto Imports             | âŒ             | âœ…                | âœ…
webpack                  | 4              | 4                 | 5
Vite                     | âš ï¸ Partial      | ğŸš§ Partial        | âœ…
Nuxt CLI                 | âŒ Old         | âœ… nuxt           | âœ… nuxt
Static sites             | âœ…             | âœ…                | âœ…

## ä» Nuxt 2 è¿ç§»åˆ° Nuxt 3+

è¿ç§»æŒ‡å—æä¾›äº† Nuxt 2 ç‰¹æ€§ä¸ Nuxt 3+ ç‰¹æ€§çš„é€æ­¥å¯¹æ¯”ï¼Œä»¥åŠå¦‚ä½•é€‚é…ç°æœ‰åº”ç”¨çš„æŒ‡å¯¼ã€‚

::read-more{to="/docs/migration/overview"}
æŸ¥çœ‹ **ä» Nuxt 2 è¿ç§»åˆ° Nuxt 3 çš„å®Œæ•´æŒ‡å—**ã€‚
::

## ä» Nuxt 2 è¿ç§»åˆ° Nuxt Bridge

å¦‚æœä½ å¸Œæœ›æ¸è¿›è¿ç§» Nuxt 2 åº”ç”¨åˆ° Nuxt 3ï¼Œå¯ä»¥ä½¿ç”¨ Nuxt Bridgeã€‚Nuxt Bridge æ˜¯ä¸€ä¸ªå…¼å®¹å±‚ï¼Œå…è®¸ä½ åœ¨ Nuxt 2 ä¸­æŒ‰éœ€å¯ç”¨ Nuxt 3+ çš„ç‰¹æ€§ã€‚

::read-more{to="/docs/bridge/overview"}
**ä» Nuxt 2 è¿ç§»åˆ° Nuxt Bridge**ã€‚
::
